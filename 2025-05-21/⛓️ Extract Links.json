{"createdAt":"2025-04-21T23:53:33.288Z","updatedAt":"2025-05-20T22:32:56.000Z","id":"lBkDISX9Vn0oLdZH","name":"⛓️ Extract Links","active":true,"nodes":[{"parameters":{"operation":"getAll","tableId":"tasks","returnAll":true,"matchType":"allFilters","filters":{"conditions":[{"keyName":"category","condition":"eq","keyValue":"app"},{"keyName":"app_link","condition":"ilike"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[220,0],"id":"0ff73db6-e975-4d63-bf1c-d1ec8d1887b9","name":"Get App Tasks","credentials":{"supabaseApi":{"id":"4EHtJhQUmG6XN1Mw","name":"Supabase account"}}},{"parameters":{"operation":"get","tableId":"emails","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $json.extracted_from_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[660,0],"id":"d636f7fc-cafe-46a9-8893-36fad7767b47","name":"Get Email","credentials":{"supabaseApi":{"id":"4EHtJhQUmG6XN1Mw","name":"Supabase account"}}},{"parameters":{"operation":"update","tableId":"tasks","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $('Get App Tasks').item.json.id }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"app_link","fieldValue":"={{ $json.output.link }}"},{"fieldId":"app_name","fieldValue":"={{ $json.output.app_name }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1376,0],"id":"98b18cd7-2038-470b-8a03-82c818dca56d","name":"Update Task","credentials":{"supabaseApi":{"id":"4EHtJhQUmG6XN1Mw","name":"Supabase account"}}},{"parameters":{"rule":{"interval":[{"field":"hours","hoursInterval":6}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,0],"id":"ceed3a5b-6ffc-4f00-be18-f37074cc29b5","name":"Schedule Trigger"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"55afe4cf-f6fb-4735-b342-cca626a96143","leftValue":"={{ $json.app_link }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[440,0],"id":"65a79dfa-76ce-4787-b57c-79fadc88fd94","name":"Filter"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[1000,222.5],"id":"b0002455-f49b-4b81-b301-a50dd984b12a","name":"Auto-fixing Output Parser"},{"parameters":{"jsonSchemaExample":"{\n  \"app_name\": \"AppName\",\n  \"link\": \"https://existing-link-from-email.com/page\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1148,420],"id":"279ee219-0f60-4249-8999-1bda4dde05b3","name":"Structured Output Parser"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{"temperature":0.2}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[880,220],"id":"b3f6db65-334b-46dd-b639-668edfa678ac","name":"4.1 Mini","credentials":{"openAiApi":{"id":"hyDTTerH5EyySsq0","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{"temperature":0.1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[960,420],"id":"7ae4c603-8e38-4556-8d71-64e97820c7c1","name":"4.1","credentials":{"openAiApi":{"id":"hyDTTerH5EyySsq0","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"=## Email subject: {{ $json.subject }}\n\n## Email body: {{ $json.body }}\n\n## Email sender: {{ $json.sender }}\n\n## Task: {{ $('Get App Tasks').item.json.description }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=# Role\nYou are Deep Link Extractor, a specialized tool that processes emails to extract **real** deep links related to a specific task. You must only extract links that physically exist in the email body — do **not fabricate or guess URLs** under any circumstance.\n\n# Task\nYou will receive four inputs:\n- `email_body`: the raw body of the email\n- `sender_email`: the sender’s address\n- `subject`: the subject line\n- `task`: the task the user is trying to complete (e.g., “review the invoice”, “view the report”)\n\n# Your Job\n1. Extract **only the real URLs** that appear in the email body.\n2. Identify the **most relevant URL** based on the `task`. Use semantic comparison between the task and the context around the links.\n3. Infer the **app name** from the sender's email domain, subject, or the link domains.\n4. If none of the real links clearly match the task, return the one most likely to be the app’s homepage.\n5. You **must never make up a link**. Only use links that are *present in the email body*.\n\n# Output Format\nRespond only with this JSON structure:\n\n{\n  \"app_name\": \"AppName\",\n  \"link\": \"https://existing-link-from-email.com/page\"\n}\n\n\n# Rules\n- Absolutely no fabricated or inferred URLs. All links **must exist in the email body.**\n- Always return one link.\n- Always return an app name (or the domain name if unsure).\n- No extra comments, no explanations, no backticks — just clean JSON."}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[896,0],"id":"9425ea5b-00c0-411b-8aec-1c669cfaeff5","name":"Extract Link and App"}],"connections":{"Get App Tasks":{"main":[[{"node":"Filter","type":"main","index":0}]]},"Get Email":{"main":[[{"node":"Extract Link and App","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get App Tasks","type":"main","index":0}]]},"Filter":{"main":[[{"node":"Get Email","type":"main","index":0}]]},"Auto-fixing Output Parser":{"ai_outputParser":[[{"node":"Extract Link and App","type":"ai_outputParser","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser","type":"ai_outputParser","index":0}]]},"4.1 Mini":{"ai_languageModel":[[{"node":"Extract Link and App","type":"ai_languageModel","index":0}]]},"4.1":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser","type":"ai_languageModel","index":0}]]},"Extract Link and App":{"main":[[{"node":"Update Task","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"3DwlFyiaSzmnZPkS"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[12]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"9034d896-abce-4125-a970-012503fe7347","triggerCount":1,"tags":[]}