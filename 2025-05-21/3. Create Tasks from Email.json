{"createdAt":"2025-05-05T18:39:48.263Z","updatedAt":"2025-05-20T22:33:36.000Z","id":"LKAAxIpErvFQzpD9","name":"3. Create Tasks from Email","active":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"email","type":"object"},{"name":"user","type":"object"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-20,-45],"id":"a7b940f6-ed36-4b4f-b73c-5d9efffbcae7","name":"When Executed by Another Workflow"},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"threadEmails","include":"specifiedFields","fieldsToInclude":"body,date_received","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1300,-45],"id":"eb858940-859c-4c04-9edc-44688221f1b4","name":"Aggregate Thread"},{"parameters":{"workflowId":{"__rl":true,"value":"MMgTPtbOWynL7Lma","mode":"list","cachedResultName":" Extract Tasks From Email Body"},"workflowInputs":{"mappingMode":"defineBelow","value":{"blacklistedApps":"={{ $('Set Irrelevant Apps').item.json.irrelevantApps }}","sender":"={{ $('When Executed by Another Workflow').first().json.email.sender_email }}","senderName":"={{ $('When Executed by Another Workflow').first().json.email.sender_name }}","subject":"={{ $('When Executed by Another Workflow').first().json.email.subject }}","recipientEmail":"={{ $('When Executed by Another Workflow').first().json.user.email }}","recipientName":"={{ $('When Executed by Another Workflow').first().json.user.display_name }}","emailDate":"={{ $('When Executed by Another Workflow').first().json.email.date_received }}","body":"={{ $('When Executed by Another Workflow').first().json.email.body }}","threadEmails":"={{ $json.threadEmails }}"},"matchingColumns":[],"schema":[{"id":"blacklistedApps","displayName":"blacklistedApps","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array"},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"senderName","displayName":"senderName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"subject","displayName":"subject","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientEmail","displayName":"recipientEmail","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientName","displayName":"recipientName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"emailDate","displayName":"emailDate","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"body","displayName":"body","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"threadEmails","displayName":"threadEmails","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1520,-45],"id":"1ee2ca63-8c63-429a-866c-163bf44304a3","name":"Extract Tasks from Email Body"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fc3f9057-2d08-4d5a-aac0-2628c6e92688","leftValue":"={{ $json.extractedTasks.tasks }}","rightValue":1,"operator":{"type":"array","operation":"lengthGt","rightType":"number"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1740,-45],"id":"b5d571c0-fb69-44e9-8131-54b36773805a","name":"Multiple tasks?"},{"parameters":{"workflowId":{"__rl":true,"value":"m8dd4woIWnJmUDBi","mode":"list","cachedResultName":" Merge Tasks"},"workflowInputs":{"mappingMode":"defineBelow","value":{"tasks":"={{ $json.extractedTasks.tasks }}"},"matchingColumns":["tasks"],"schema":[{"id":"tasks","displayName":"tasks","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1960,-120],"id":"65520340-2ea1-4f02-bbd9-8ebed6871e54","name":"Merge Tasks"},{"parameters":{"assignments":{"assignments":[{"id":"db230891-2ce4-42b3-8010-c66a2ebfd05f","name":"tasks","value":"={{ $json.mergedTasks ?? $json.extractedTasks.tasks }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2180,-45],"id":"6d64d44a-39c9-41d6-a75a-dc4439e90bf2","name":"Set Tasks"},{"parameters":{"fieldToSplitOut":"tasks","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[2400,-45],"id":"f0214b5b-c6af-431c-96c1-4a932dc32302","name":"Split Out"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[2620,-45],"id":"d0a47166-3f2e-425d-a568-c0ea917ccba7","name":"Loop Over Items"},{"parameters":{"assignments":{"assignments":[{"id":"de7da724-a982-4109-bb01-7684f6fd5cb4","name":"priority","value":"={{ $json.priority ?? \"low\" }}","type":"string"},{"id":"abf867ba-aa18-42b7-b5d6-74e5d95b08de","name":"category","value":"={{ $json.category.toLowerCase() ?? \"reply\" }}","type":"string"},{"id":"3cb7577b-5e71-43b4-b740-e21412c31449","name":"due_date","value":"={{ $json.due_date == \"today\" ? $now.toUTC().toISO() : $json.due_date }}","type":"string"},{"id":"882ce4ea-7507-49f5-aefa-698685f096c2","name":"created_at","value":"={{ $now.toUTC().toISO() }}","type":"string"},{"id":"132d6e39-a5fd-4491-a2d0-3d996cd873e8","name":"user_id","value":"={{ $('When Executed by Another Workflow').first().json.user.id }}","type":"string"},{"id":"6aecce0f-fff3-49fe-9a64-b06825c04fb3","name":"email_id","value":"={{ $('When Executed by Another Workflow').first().json.email.email_id }}","type":"string"},{"id":"853efffc-a02e-426e-8112-094b906a0dbc","name":"description","value":"={{ $json.description ?? $('When Executed by Another Workflow').first().json.email.subject }}","type":"string"},{"id":"079359da-3efb-4b09-b366-8638e4327929","name":"extracted_from_id","value":"={{ $('When Executed by Another Workflow').first().json.email.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2840,-120],"id":"da291a22-cd51-454f-b885-520b729dae30","name":"Set DB Task Fields"},{"parameters":{"action":"generate","dataPropertyName":"task_id"},"type":"n8n-nodes-base.crypto","typeVersion":1,"position":[3060,-120],"id":"ec416307-53ef-483e-a4cb-36e9a89538cd","name":"Generate Task ID"},{"parameters":{"assignments":{"assignments":[{"id":"5683ea4e-de11-453a-9c76-f1d72312a365","name":"app_name","value":"={{ $json.deep_link.app_name ?? \"\" }}","type":"string"},{"id":"cb8bbdb5-2ff0-4b46-a746-c31fa03c0ef5","name":"link","value":"={{ $json.deep_link.link.replaceAll(\"\\\"\", \"\") ?? \"\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3500,-120],"id":"7dac27ea-aea2-4ff8-91e2-aeac68b14da3","name":"Set Link Data"},{"parameters":{"operation":"get","tableId":"email_threads","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $('When Executed by Another Workflow').first().json.email.thread_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[860,-45],"id":"086da63e-5d02-4ac2-9575-db487050620f","name":"Get Thread","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"4EHtJhQUmG6XN1Mw","name":"Supabase account"}}},{"parameters":{"workflowId":{"__rl":true,"value":"tTPLJBStstyIerUW","mode":"list","cachedResultName":" Draft Response"},"workflowInputs":{"mappingMode":"defineBelow","value":{"type":"={{ $('Generate Task ID').item.json.category }}","taskDescription":"={{ $('Generate Task ID').item.json.description }}","recipientName":"={{ $('When Executed by Another Workflow').first().json.user.display_name }}","senderName":"={{ $('When Executed by Another Workflow').first().json.email.sender_name }}","body":"={{ $('When Executed by Another Workflow').first().json.email.body }}","threadSummary":"={{ $('Get Thread').item.json.summary }}"},"matchingColumns":[],"schema":[{"id":"type","displayName":"type","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"body","displayName":"body","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"threadSummary","displayName":"threadSummary","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"taskDescription","displayName":"taskDescription","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"senderName","displayName":"senderName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientName","displayName":"recipientName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[3720,-120],"id":"91f229e6-778f-473a-9579-eda8550a7fe2","name":"Draft Response"},{"parameters":{"workflowId":{"__rl":true,"value":"OF3waOxKRRBnk3qZ","mode":"list","cachedResultName":" Create Extended Task Description"},"workflowInputs":{"mappingMode":"defineBelow","value":{"priority":"={{ $('Generate Task ID').item.json.priority }}","taskDescription":"={{ $('Generate Task ID').item.json.description }}","threadSummary":"={{ $('Get Thread').item.json.summary }}","dueDate":"={{ $('Generate Task ID').item.json.due_date }}","senderName":"={{ $('When Executed by Another Workflow').first().json.email.sender_name }}","senderEmail":"={{ $('When Executed by Another Workflow').first().json.email.sender_email }}","body":"={{ $('When Executed by Another Workflow').first().json.email.body }}","subject":"={{ $('When Executed by Another Workflow').first().json.email.subject }}","recipientName":"={{ $('When Executed by Another Workflow').first().json.user.display_name }}","recipientEmail":"={{ $('When Executed by Another Workflow').first().json.user.email }}"},"matchingColumns":[],"schema":[{"id":"subject","displayName":"subject","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"body","displayName":"body","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"threadSummary","displayName":"threadSummary","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"taskDescription","displayName":"taskDescription","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"dueDate","displayName":"dueDate","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"priority","displayName":"priority","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"senderName","displayName":"senderName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"senderEmail","displayName":"senderEmail","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientName","displayName":"recipientName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientEmail","displayName":"recipientEmail","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[3940,-120],"id":"eb846eed-4009-4f97-8e50-14bf53bfedbb","name":"Create Extended Task Description"},{"parameters":{"workflowId":{"__rl":true,"value":"qP3tXqXbcMQzoeUv","mode":"list","cachedResultName":" Extract Links and App Name"},"workflowInputs":{"mappingMode":"defineBelow","value":{"taskDescription":"={{ $json.description }}","subject":"={{ $('When Executed by Another Workflow').first().json.email.subject }}","sender":"={{ $('When Executed by Another Workflow').first().json.email.sender }}","body":"={{ $('When Executed by Another Workflow').first().json.email.body }}"},"matchingColumns":[],"schema":[{"id":"body","displayName":"body","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"taskDescription","displayName":"taskDescription","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"subject","displayName":"subject","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[3280,-120],"id":"c7f1e320-8801-49a0-b1a2-43b9a65b4242","name":"Extract Link"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"app_name"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[420,-45],"id":"cf9ace4b-a23a-414e-be0a-9fe37a996a76","name":"Aggregate"},{"parameters":{"assignments":{"assignments":[{"id":"3ab6e524-7f90-4b45-8c1a-007dc5acf22f","name":"irrelevantApps","value":"={{ $json.app_name }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[640,-45],"id":"d53472cd-7b78-4c67-bfc5-a00bd315c39d","name":"Set Irrelevant Apps"},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT(app_name)\nFROM tasks\nWHERE progress = 'deleted'\nAND category = 'app'\nAND app_name <> ''\nAND app_name IS NOT NULL;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[200,-45],"id":"03fdb821-5ee1-445f-b442-fe6499cba539","name":"Find Names of Irrelevant Apps","alwaysOutputData":true,"credentials":{"postgres":{"id":"kI6uSN0fI2Vhpmlk","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT body, date_received\nFROM emails\nWHERE thread_id = '{{ $('When Executed by Another Workflow').item.json.email.thread_id }}'\nORDER BY date_received DESC\nLIMIT 3;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1080,-45],"id":"63bbe0c4-b16f-4253-9574-4b68cc26e28c","name":"Get Emails in Thread","alwaysOutputData":true,"credentials":{"postgres":{"id":"kI6uSN0fI2Vhpmlk","name":"Postgres account"}}},{"parameters":{"tableId":"tasks","fieldsUi":{"fieldValues":[{"fieldId":"id","fieldValue":"={{ $('Generate Task ID').item.json.task_id }}"},{"fieldId":"created_at","fieldValue":"={{ $('Generate Task ID').item.json.created_at }}"},{"fieldId":"description","fieldValue":"={{ $('Generate Task ID').item.json.description }}"},{"fieldId":"due_date","fieldValue":"={{ $('Generate Task ID').item.json.due_date }}"},{"fieldId":"category","fieldValue":"={{ $('Generate Task ID').item.json.category }}"},{"fieldId":"priority","fieldValue":"={{ $('Generate Task ID').item.json.priority }}"},{"fieldId":"user_id","fieldValue":"={{ $('Generate Task ID').item.json.user_id }}"},{"fieldId":"email_id","fieldValue":"={{ $('Generate Task ID').item.json.email_id }}"},{"fieldId":"app_name","fieldValue":"={{ $('Set Link Data').item.json.app_name }}"},{"fieldId":"app_link","fieldValue":"={{ $('Set Link Data').item.json.link }}"},{"fieldId":"draft_response","fieldValue":"={{ $('Draft Response').item.json.response }}"},{"fieldId":"extracted_from_id","fieldValue":"={{ $('Generate Task ID').item.json.extracted_from_id }}"},{"fieldId":"description_extended","fieldValue":"={{ $json.description }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[4160,-45],"id":"6141811c-8195-4f9a-84d4-5d22edf887c2","name":"Insert Task","credentials":{"supabaseApi":{"id":"4EHtJhQUmG6XN1Mw","name":"Supabase account"}}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Find Names of Irrelevant Apps","type":"main","index":0}]]},"Aggregate Thread":{"main":[[{"node":"Extract Tasks from Email Body","type":"main","index":0}]]},"Extract Tasks from Email Body":{"main":[[{"node":"Multiple tasks?","type":"main","index":0}]]},"Multiple tasks?":{"main":[[{"node":"Merge Tasks","type":"main","index":0}],[{"node":"Set Tasks","type":"main","index":0}]]},"Merge Tasks":{"main":[[{"node":"Set Tasks","type":"main","index":0}]]},"Set Tasks":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Set DB Task Fields","type":"main","index":0}]]},"Set DB Task Fields":{"main":[[{"node":"Generate Task ID","type":"main","index":0}]]},"Generate Task ID":{"main":[[{"node":"Extract Link","type":"main","index":0}]]},"Set Link Data":{"main":[[{"node":"Draft Response","type":"main","index":0}]]},"Get Thread":{"main":[[{"node":"Get Emails in Thread","type":"main","index":0}]]},"Draft Response":{"main":[[{"node":"Create Extended Task Description","type":"main","index":0}]]},"Create Extended Task Description":{"main":[[{"node":"Insert Task","type":"main","index":0}]]},"Extract Link":{"main":[[{"node":"Set Link Data","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Set Irrelevant Apps","type":"main","index":0}]]},"Set Irrelevant Apps":{"main":[[{"node":"Get Thread","type":"main","index":0}]]},"Find Names of Irrelevant Apps":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Get Emails in Thread":{"main":[[{"node":"Aggregate Thread","type":"main","index":0}]]},"Insert Task":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"3DwlFyiaSzmnZPkS"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"63aaba00-7a5e-4158-8927-6274901c567e","triggerCount":0,"tags":[]}