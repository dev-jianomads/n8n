{"createdAt":"2025-04-21T23:54:09.671Z","updatedAt":"2025-05-20T22:36:57.000Z","id":"9eAG34NdBdOkAM5x","name":"Block Time","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"3965b93b-8fa0-47a0-b824-e1d366168b67","responseMode":"responseNode","options":{"rawBody":false}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-620,150],"id":"6647ea44-ad6b-4f86-ad41-334f0df4f3dd","name":"Webhook","webhookId":"3965b93b-8fa0-47a0-b824-e1d366168b67"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e79c59e1-a783-4bfb-a60d-ecf4104c8d36","leftValue":"={{ $json.task_id }}","rightValue":"","operator":{"type":"string","operation":"notExists","singleValue":true}},{"id":"12fff553-64e2-4a6e-be8b-b87ed6e8943e","leftValue":"={{ $json.task_id }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-400,0],"id":"ba177a2d-8e45-4c0a-8f7e-7e6ba77a3c7d","name":"Invalid Task ID?"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e79c59e1-a783-4bfb-a60d-ecf4104c8d36","leftValue":"={{ $json.start }}","rightValue":"","operator":{"type":"string","operation":"notExists","singleValue":true}},{"id":"12fff553-64e2-4a6e-be8b-b87ed6e8943e","leftValue":"={{ $json.start }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-400,300],"id":"30e6da3c-ea92-49a1-bcfc-0c8f05ce077d","name":"Invalid Start Date?"},{"parameters":{"respondWith":"json","responseBody":"{\n  \"error\": \"Bad request. Invalid value for 'task_id' or 'start' fields.\"\n}","options":{"responseCode":400}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[-180,50],"id":"4dd3d7e7-850a-45b1-b959-81f65bebde79","name":"Bad Request"},{"parameters":{"operation":"get","tableId":"tasks","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $json.task_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[40,250],"id":"1e9c1400-3210-4ba1-80d0-b1ac20a2fb70","name":"Get Task","credentials":{"supabaseApi":{"id":"4EHtJhQUmG6XN1Mw","name":"Supabase account"}}},{"parameters":{"mode":"chooseBranch"},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-180,250],"id":"90c32672-4e0e-4ea6-a0fb-55aae0bed035","name":"Merge"},{"parameters":{"workflowId":{"__rl":true,"value":"a9oyiaBgYtI20uv8","mode":"list","cachedResultName":"Get Token"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"={{ $('Get Task').item.json.user_id }}"},"matchingColumns":["user_id"],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[260,250],"id":"4d25478b-ae8e-4f58-af1f-4f4771f877c4","name":"Get Token"},{"parameters":{"assignments":{"assignments":[{"id":"901f3674-46a1-49bd-8ecc-d00442ddfa0d","name":"attendees","value":"={{ $('Merge').item.json.attendees.append($json.user.email)}}","type":"array"},{"id":"31775448-3649-4e21-bc93-c91cb76b015e","name":"endDate","value":"={{ DateTime.fromISO($('Webhook').item.json.start).plus($('Webhook').item.json.duration, 'minutes') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,250],"id":"bb9789a4-7bfe-4287-9953-b8710d6043e8","name":"Set Attendees & End Date"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/calendar/v3/calendars/primary/events","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('Get Token').item.json.accessToken }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify($json) }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[920,250],"id":"6900247c-43be-4e6e-8eff-8c5046d58026","name":"Create Event","onError":"continueErrorOutput"},{"parameters":{"options":{"responseCode":200}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1140,150],"id":"aecf9620-7f61-4f6b-b6af-c24534ef1247","name":"Success"},{"parameters":{"options":{"responseCode":500,"responseKey":"=Problem creating the event: {{ $json.error }}"}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1140,350],"id":"a6002bca-d950-4f10-8921-6b5a9e797857","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the JSON of the item\n$input.item.json.calendarRequest = {\n  description: $('Get Task').item.json.description,\n  summary: $('Webhook').item.json.title || $('Get Task').item.json.description,\n  start: {\n    dateTime: $('Webhook').item.json.start,\n    timeZone: $('Get Token').item.json.user.time_zone\n  },\n  end: {\n    dateTime: $json.endDate,\n    timeZone: $('Get Token').item.json.user.time_zone\n  },\n  reminders: {\n    useDefault: false,\n    overrides: [\n      {method: \"email\", minutes: 1440},\n      {method: \"popup\", \"minutes\": 10},\n    ],\n  },\n  attendees: $json.attendees?.map(email => ({ email })) ?? []\n};\n\nreturn $input.item;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[700,250],"id":"e1463d13-aa64-4ec2-94a9-e0a5724ef59e","name":"Create Event Request"}],"connections":{"Webhook":{"main":[[{"node":"Invalid Task ID?","type":"main","index":0},{"node":"Invalid Start Date?","type":"main","index":0}]]},"Invalid Task ID?":{"main":[[{"node":"Bad Request","type":"main","index":0}],[{"node":"Merge","type":"main","index":0}]]},"Invalid Start Date?":{"main":[[{"node":"Bad Request","type":"main","index":0}],[{"node":"Merge","type":"main","index":1}]]},"Get Task":{"main":[[{"node":"Get Token","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Get Task","type":"main","index":0}]]},"Get Token":{"main":[[{"node":"Set Attendees & End Date","type":"main","index":0}]]},"Set Attendees & End Date":{"main":[[{"node":"Create Event Request","type":"main","index":0}]]},"Create Event":{"main":[[{"node":"Success","type":"main","index":0}],[{"node":"Respond to Webhook","type":"main","index":0}]]},"Create Event Request":{"main":[[{"node":"Create Event","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"3DwlFyiaSzmnZPkS"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"6a8cb8d9-3f33-4b18-84c5-21ff00e8fd11","triggerCount":1,"tags":[]}