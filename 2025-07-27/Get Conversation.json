{"createdAt":"2025-07-16T22:25:03.267Z","updatedAt":"2025-07-23T23:49:13.328Z","id":"K7dK4EzGjSmTsV8d","name":"Get Conversation","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"phone"},{"name":"signal_uuid"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-128,0],"id":"150d6595-777a-48b4-810c-19bc5caf2a25","name":"When Executed by Another Workflow"},{"parameters":{"operation":"executeQuery","query":"SELECT\n  signal_timestamp_utc AS date,\n  message_text AS message,\n  CASE\n    WHEN direction = 'inbound' THEN 'user'\n    ELSE 'ai'\n  END AS role\nFROM\n  signal_messages\nWHERE (recipient_uuid = '{{ $('When Executed by Another Workflow').item.json.signal_uuid }}' OR sender_uuid = '{{ $('When Executed by Another Workflow').item.json.signal_uuid }}')\nOR (recipient_phone = '{{ $('When Executed by Another Workflow').item.json.phone }}' OR sender_phone = '{{ $('When Executed by Another Workflow').item.json.phone }}')\nORDER BY signal_timestamp DESC\nLIMIT 20;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[112,0],"id":"673cfd3e-cc7a-4bf3-98b9-122395826320","name":"Get Messages","retryOnFail":true,"waitBetweenTries":2000,"credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"chat_history","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[320,0],"id":"6b97ff20-90ff-410d-84d4-1a65d49b6257","name":"Aggregate"},{"parameters":{"content":"## TODO:\n\nReturn only the messages from the last 2 hours.","color":3},"type":"n8n-nodes-base.stickyNote","position":[32,-192],"typeVersion":1,"id":"43fddcb3-cf9c-4100-911b-b6aee204d3fd","name":"Sticky Note"}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Get Messages","type":"main","index":0}]]},"Get Messages":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"signal_uuid":"1794451c-454e-4a15-b409-99a0c19f5bcd","phone":"+573195884149"}}]},"versionId":"f677d03f-7f23-461e-b3f3-b4ce788096da","triggerCount":0,"tags":[]}