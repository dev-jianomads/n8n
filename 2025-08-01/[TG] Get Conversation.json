{"createdAt":"2025-07-30T17:51:55.785Z","updatedAt":"2025-07-30T21:17:59.980Z","id":"hcMQex513eYi8K2H","name":"[TG] Get Conversation","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"telegramId"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-128,0],"id":"54a27d76-f1b7-43db-bd40-32e6e743c43e","name":"When Executed by Another Workflow"},{"parameters":{"operation":"executeQuery","query":"SELECT\n  telegram_date_utc AS date,\n  text AS message,\n  CASE\n    WHEN direction = 'inbound' THEN 'user'\n    ELSE 'ai'\n  END AS role\nFROM\n  telegram_messages\nWHERE (recipient_id = '{{ $('When Executed by Another Workflow').item.json.telegramId }}' OR sender_id = '{{ $('When Executed by Another Workflow').item.json.telegramId }}')\nORDER BY telegram_date DESC\nLIMIT 20;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[112,0],"id":"02a58e88-0329-4140-b6c7-35ddb81cacb2","name":"Get Messages","retryOnFail":true,"waitBetweenTries":2000,"credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"chat_history","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[320,0],"id":"e64ac8cf-883b-4555-a563-66724cf4f105","name":"Aggregate"}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Get Messages","type":"main","index":0}]]},"Get Messages":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"telegramId":"1598386790"}}]},"versionId":"02732d98-71f3-4f21-9230-1dc81f71c8ec","triggerCount":0,"tags":[]}