{"updatedAt":"2025-06-09T21:54:08.074Z","createdAt":"2025-06-03T14:42:46.050Z","id":"qDdOntylcSTFTsLW","name":"‚òÄÔ∏è Create Morning Report","active":true,"isArchived":false,"nodes":[{"parameters":{"operation":"executeQuery","query":"SELECT display_name, email\nFROM users\nWHERE id = '{{ $json.body.user_id }}'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[500,380],"id":"3a780382-19b1-4e50-ad7a-515b904c35ac","name":"Get Display Name & Email From User","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"operation":"executeQuery","query":"SELECT email_id, relevant \nFROM emails\nWHERE user_id = '{{ $('Webhook1').item.json.body.user_id }}'\n  AND created_at >= '{{ $today.plus('-1', 'day').toUTC().format('yyyy-MM-dd') }}'\n  AND relevant","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[940,380],"id":"2dc8e9b2-b30d-4d3e-b2f3-07af07252bce","name":"Get Email Ids","alwaysOutputData":true,"credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"email_id"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1160,380],"id":"df6ad439-f79b-4137-9925-694ca5656f13","name":"Aggregate"},{"parameters":{"operation":"executeQuery","query":"SELECT COUNT(*)\nFROM tasks\nWHERE email_id IN ({{ JSON.stringify($json.email_id).replaceAll(\"[\", \"\").replaceAll(\"]\", \"\").replaceAll(\"\\\"\", \"'\") }})","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1600,480],"id":"9f82bbf1-f2c7-42c5-81cd-fd70a6d84b0c","name":"Count Tasks","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"operation":"executeQuery","query":"SELECT COUNT(*) \nFROM emails\nWHERE user_id = '{{ $('Webhook1').item.json.body.user_id }}'\n  AND created_at >= '{{ $today.plus('-1', 'day').toUTC().format('yyyy-MM-dd') }}'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[720,380],"id":"7fbd1b29-37c2-4ed6-98d3-fae08153549c","name":"Count All Emails","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"64394273-c2e7-4db7-981c-32f8b69d867a","leftValue":"={{ $json.email_id.length }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1380,380],"id":"e8a8964b-8e81-405e-aeb7-9d3e6682220a","name":"If"},{"parameters":{"assignments":{"assignments":[{"id":"43e9ac24-d294-4b65-9b8d-e442bd7c6529","name":"count","value":0,"type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1600,280],"id":"5570053d-82e9-4193-8385-a8091254e9c9","name":"Set Taks Count"},{"parameters":{"sendTo":"={{ $('Get Display Name & Email From User').first().json.email }}","subject":"={{ $today.format('yyyy-MM-dd') }} - Morning Task Report","message":"=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Morning Task Report</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            line-height: 1.6;\n            color: #333333;\n            background-color: #f4f4f4;\n            margin: 0;\n            padding: 0;\n        }\n        .container {\n            max-width: 600px;\n            margin: 20px auto;\n            background: #ffffff;\n            border-radius: 8px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n            overflow: hidden;\n        }\n        .header {\n            background-color: #4CAF50;\n            color: #ffffff;\n            text-align: center;\n            padding: 15px;\n        }\n        .content {\n            padding: 20px;\n        }\n        .content h1 {\n            font-size: 24px;\n            color: #333333;\n        }\n        .metrics {\n            margin: 20px 0;\n            font-size: 18px;\n            line-height: 1.4;\n        }\n        .cta-button {\n            display: inline-block;\n            background-color: #4CAF50;\n            color: #ffffff;\n            text-decoration: none;\n            padding: 10px 20px;\n            border-radius: 5px;\n            font-weight: bold;\n        }\n        .footer {\n            text-align: center;\n            font-size: 14px;\n            color: #777777;\n            padding: 10px;\n            background-color: #f4f4f4;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <h2>Morning Task Extraction Report</h2>\n        </div>\n\n        <!-- Content -->\n        <div class=\"content\">\n            <h1>Good morning, {{ $('Get Display Name & Email From User').first().json.display_name }}!</h1>\n            <p class=\"metrics\">\n                Here's what we accomplished since yesterday:<br>\n                <strong>{{ $('Count All Emails').first().json.count }}</strong> emails processed<br>\n                <strong>{{ $('Aggregate').first().json.email_id.length }}</strong> emails identified as relevant<br>\n                <strong>{{ $json.count }}</strong> tasks extracted\n            </p>\n            <p>\n                <a href=\"{link_to_tomo}\" class=\"cta-button\">Head over to Tomo</a>\n            </p>\n        </div>\n\n        <!-- Footer -->\n        <div class=\"footer\">\n            Have a productive day ahead!<br>\n            <strong>The Task Extraction Team</strong>\n        </div>\n    </div>\n</body>\n</html>","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1820,380],"id":"a14f147a-628b-4a12-a2ac-0cc469aa8de7","name":"Send Morning Report","webhookId":"3ed2021a-d66b-49b2-accb-872b11bcc3d9","credentials":{"gmailOAuth2":{"id":"uHTRCQuNYrnFIbNI","name":"Gmail account"}}},{"parameters":{"content":"**üìù Morning Report Workflow**\n\n* **Trigger**: Webhook (`/morning_report`)\n* **Gets**: User info ‚Üí Emails (past 24h) ‚Üí Relevant emails ‚Üí Tasks\n* **Logic**:\n\n  * No relevant emails ‚Üí tasks = 0\n  * Else ‚Üí count tasks\n* **Output**: Sends HTML report via Gmail\n","height":240,"width":660,"color":6},"type":"n8n-nodes-base.stickyNote","position":[260,80],"typeVersion":1,"id":"5f6abe68-6ecb-4b73-a5ba-84d978f4f905","name":"Sticky Note"},{"parameters":{"httpMethod":"POST","path":"morning_report","authentication":"headerAuth","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[280,380],"id":"a578902e-b162-4a6e-996f-aa7811df49ea","name":"Webhook","webhookId":"1c641698-47ff-4573-8886-6dedd41be81c","credentials":{"httpHeaderAuth":{"id":"kpchGH0oruKJ0XiH","name":"JIA Authorization Header Auth"}}}],"connections":{"Get Display Name & Email From User":{"main":[[{"node":"Count All Emails","type":"main","index":0}]]},"Get Email Ids":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"If","type":"main","index":0}]]},"Count Tasks":{"main":[[{"node":"Send Morning Report","type":"main","index":0}]]},"Count All Emails":{"main":[[{"node":"Get Email Ids","type":"main","index":0}]]},"If":{"main":[[{"node":"Set Taks Count","type":"main","index":0}],[{"node":"Count Tasks","type":"main","index":0}]]},"Set Taks Count":{"main":[[{"node":"Send Morning Report","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Get Display Name & Email From User","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"c1937ea6-e1ae-4c6d-b814-d4bf252d1e50","triggerCount":1,"shared":[{"updatedAt":"2025-06-03T14:42:46.050Z","createdAt":"2025-06-03T14:42:46.050Z","role":"workflow:owner","workflowId":"qDdOntylcSTFTsLW","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}