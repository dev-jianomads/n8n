{"updatedAt":"2025-11-23T01:17:27.754Z","createdAt":"2025-11-22T21:54:05.928Z","id":"SWHvDqdjFwtkO7cb","name":"[Slack] Slack Tomo Scheduler","active":false,"isArchived":true,"nodes":[{"parameters":{"description":"Use this tool to find available time slots in the user's calendar within a specified time range. Use this as the first step for any scheduling request to check for availability.\n\nParameters:\n\nlimit (integer): The maximum number of available time slots to return. If not specified, the default value is 10.\n\nfrom (string): The start of the time range to search, formatted as an ISO 8601 string (e.g., \"2025-07-21T09:00:00-05:00\"). This field is required.\n\nto (string): The end of the time range to search, formatted as an ISO 8601 string (e.g., \"2025-07-21T17:00:00-05:00\"). This field is required.","workflowId":{"__rl":true,"value":"Pv8zj52U0QidPFvy","mode":"list","cachedResultUrl":"/workflow/Pv8zj52U0QidPFvy","cachedResultName":"[WA] Find Time"},"workflowInputs":{"mappingMode":"defineBelow","value":{"userId":"={{ $('When Executed by Another Workflow').item.json.user.user_id }}","limit":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('limit', ``, 'number') }}","from":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('from', ``, 'string') }}","to":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('to', ``, 'string') }}","timeZone":"={{ $json.time_zone }}"},"matchingColumns":[],"schema":[{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"limit","displayName":"limit","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"from","displayName":"from","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"to","displayName":"to","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"timeZone","displayName":"timeZone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[960,192],"id":"7cae496c-2737-41f3-a943-4fb98b706fd2","name":"Find Time"},{"parameters":{"description":"=Creates a new event in the user's calendar and generates a Google Meet link for it. Use this tool only after a specific time slot has been confirmed by the user, unless it's for an \"instant meeting\" request.\n\n**Parameters:**\n\n* **`title`** (`string`): The main title for the calendar event. This field is required.\n* **`description`** (`string`): A detailed description for the event. This is an optional field.\n* **`start`** (`string`): The start time for the event, formatted as an ISO 8601 string (e.g., \"2025-07-21T14:30:00-05:00\"). This field is required.\n* **`duration`** (`integer`): The duration of the event in minutes. If not specified, the default value is **60**.","workflowId":{"__rl":true,"value":"qBdskGKPvdYqHAQI","mode":"list","cachedResultUrl":"/workflow/qBdskGKPvdYqHAQI","cachedResultName":"[WA] Create Event + Meeting Link"},"workflowInputs":{"mappingMode":"defineBelow","value":{"description":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('description', ``, 'string') }}","start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('start', ``, 'string') }}","duration":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('duration', ``, 'number') }}","title":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('title', ``, 'string') }}","userId":"={{ $('When Executed by Another Workflow').item.json.user.user_id }}","summary":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('summary', ``, 'string') }}","attendees":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('attendees', `Comma-separated list of emails of the attendees to the event. If there are no attendees, THIS SHOULD BE \"NONE\".`, 'string') }}","location":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('location', `The location of the event. For instance, \"Restaurante Gato Negro\". By default, if no location is specified or the user does not specify one, use N/A.`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"description","displayName":"description","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"start","displayName":"start","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"duration","displayName":"duration","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"title","displayName":"title","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"summary","displayName":"summary","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"attendees","displayName":"attendees","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"location","displayName":"location","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1088,192],"id":"901f9425-5066-43fe-bae5-4cfaa4b7df86","name":"Block Time"},{"parameters":{"assignments":{"assignments":[{"id":"e7c04ea2-8405-4ce5-b1d9-d0eb808c561a","name":"response","value":"={{ $('Tomo Scheduler').item.json.output }}","type":"string"},{"id":"dd2a0ccc-5484-495e-b2fa-98d6c53f561a","name":"toolActivity","value":"={{ $('Tomo Scheduler').item.json.intermediateSteps.map(item => ({\n  tool_name: item.action.tool,\n  tool_input: item.action.toolInput,\n  tool_output: JSON.stringify(item.observation)\n})) }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2288,-32],"id":"407a810f-f3d5-44fb-9c56-e0d3e426983e","name":"Set Response"},{"parameters":{"description":"=Use this tool to search for and retrieve events from the user's Google Calendar. It is the essential first step for answering any questions about the user's schedule or finding a specific event's ID before you can update or delete it.\n\nWhen to use this tool:\n\nWhen the user asks \"What's on my calendar?\", \"Do I have anything tomorrow?\", or asks about their schedule for any time period.\n\nWhen you need to find a specific event before modifying it. For example, if the user says, \"reschedule my meeting with Ken,\" you must first use this tool to find that meeting.\n\nWhen the user asks if they are free or busy at a specific time.\n\nKey Inputs: You can filter events by a time range (e.g., today, tomorrow, next week), keywords from the event title (e.g., \"Budget meeting\"), or attendee names (e.g., \"Ken\").\n\n\n\n\n\n\n\n","workflowId":{"__rl":true,"value":"lev8BlowqB1nvPSf","mode":"list","cachedResultUrl":"/workflow/lev8BlowqB1nvPSf","cachedResultName":"[WA] List Events"},"workflowInputs":{"mappingMode":"defineBelow","value":{"userId":"={{ $('When Executed by Another Workflow').item.json.user.user_id }}","from":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('from', ``, 'string') }}","to":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('to', ``, 'string') }}","timeZone":"={{ $json.time_zone }}","query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `A free-text search string used to find events by their content. Extract key identifying nouns and names from the user's request (e.g., 'meeting', 'Ken', 'budget') to use as the value for this parameter.`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"from","displayName":"from","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"to","displayName":"to","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"timeZone","displayName":"timeZone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1216,192],"id":"d0ae0a1f-596d-47e3-aeb4-b61c5bd3c468","name":"List Events"},{"parameters":{"description":"=Use this tool to modify or reschedule an existing calendar event after its unique eventId has been found. This tool should be used for any request that involves changing the details of a specific event.\n\nWhen to use this tool:\n\n- After using the \"List Events\" tool to identify the specific event the user wants to change.\n\n- When the user explicitly asks to \"change,\" \"move,\" or \"reschedule\" a meeting.\n\n- When the user wants to \"add\" or \"remove\" attendees from an event, or change its \"location.\"\n\nKey Inputs: You must provide the eventId of the event to be updated, along with any new values for its start, duration, location, or attendees.\n\n\n\n\n\n\n\n","workflowId":{"__rl":true,"value":"rAVzEYVuhHkn8uDH","mode":"list","cachedResultUrl":"/workflow/rAVzEYVuhHkn8uDH","cachedResultName":"[WA] Update Event"},"workflowInputs":{"mappingMode":"defineBelow","value":{"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('start', `The start date and time for the event in ISO 8601 format.`, 'string') }}","duration":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('duration', `The length of the event in minutes(e.g., 30 or 60)`, 'number') }}","userId":"={{ $('When Executed by Another Workflow').item.json.user.user_id }}","location":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('location', ``, 'string') }}","attendees":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('attendees', `The complete list of attendee email addresses; this will replace all current participants. Comma-separated list of emails of the attendees to the event. If there are no attendees, THIS SHOULD BE \"NONE\".`, 'string') }}","summary":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('summary', `The summary/title of the event. If a new one is not specified by the user in their request, reuse the same title/summary.`, 'string') }}","eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('eventId', `The unique ID of the event to modify, obtained from the \"List Events\" tool.`, 'string') }}","timeZone":"={{ $json.time_zone }}"},"matchingColumns":[],"schema":[{"id":"start","displayName":"start","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"duration","displayName":"duration","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"location","displayName":"location","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"attendees","displayName":"attendees","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"eventId","displayName":"eventId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"summary","displayName":"summary","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"timeZone","displayName":"timeZone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1344,192],"id":"a93d31b8-ec7b-4b24-9e66-6c37ede48591","name":"Update Event"},{"parameters":{"description":"Call this tool to find places in the user's location he could use to hold meetings. Favor places like coffee shops, restaurants, gastrobars and co-working spaces.","workflowId":{"__rl":true,"value":"3Kp77vn3ETiWLCFB","mode":"list","cachedResultUrl":"/workflow/3Kp77vn3ETiWLCFB","cachedResultName":"[WA] Google Places Search API"},"workflowInputs":{"mappingMode":"defineBelow","value":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `The search query. Example: Vegan places in Honolulu, Hawaii`, 'string') }}","whatsAppId":"={{ $json.whatsapp_id }}"},"matchingColumns":[],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"whatsAppId","displayName":"whatsAppId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1472,192],"id":"a5e6fc34-c233-47dc-bbc8-198e98454876","name":"Search Places"},{"parameters":{"description":"=Use this tool to retrieve information about contacts, such as their email and name","workflowId":{"__rl":true,"value":"A1AuAvYgNDKBZINR","mode":"list","cachedResultUrl":"/workflow/A1AuAvYgNDKBZINR","cachedResultName":"[WA] Search Contacts in Vector Store"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"={{ $('When Executed by Another Workflow').item.json.user.user_id }}","query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `Name of the contact you want to retrieve info for.`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1600,192],"id":"bc128eac-764c-4efb-8f67-4fe84d030eab","name":"Search Contacts"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1.1,"position":[1728,192],"id":"0003e71d-160a-4e64-8853-93db6f45f326","name":"Think"},{"parameters":{"promptType":"define","text":"=# Chat History:\n{{ JSON.stringify($('When Executed by Another Workflow').item.json.chat_history) }}\n\n# User message\n{{ $('When Executed by Another Workflow').item.json.user_message }}","needsFallback":true,"options":{"systemMessage":"=You are an expert scheduling assistant named Tomo. Your primary goal is to help the user find available time, book meetings, and manage their calendar efficiently. You are friendly, diligent, and intelligent, anticipating user needs while adhering strictly to your operational rules and workflows.\n\n### 1. Guiding Principles\nThese are the core principles that define your behavior in every interaction.\n\n* **Persona:** You are a friendly and diligent agent. Be polite and use emojis when suitable. üòÉ\n* **Clarity and Conciseness:** Your responses should be direct and to the point. Confirm actions and provide necessary information without unnecessary conversational filler.\n* **No Assumptions:** If a user's request is ambiguous, ask clarifying questions to ensure full compliance with their intent. Never guess critical details.\n* **Favor Tool Data:** Always favor fresh data from your tools over information from the chat history. Use the conversation for context only.\n* **Think Before Acting:** For any multi-step request (like creating or modifying an event), you **MUST** first use the `Think` tool to outline your plan. This plan should follow the `Standard Operating Procedure` defined in Section 4.\n* **Interpret Numbered List Responses:** When you have presented the user with a numbered list of options (e.g., multiple contacts, multiple events), and the user replies with a single number, you **MUST** interpret that number as a selection of the corresponding item from the list. It is not a quantity.\n    * *Example:* If you present `1. Ken Wong, 2. Ken Jones` and the user replies `Invite 2`, your action is to select **Ken Jones**. You must not interpret this as a request to invite a quantity of two people.\n\n### 2. Operational Rules\nThese are non-negotiable rules you must follow when performing tasks.\n\n * **Check Availability First (Pre-check):** For any scheduling or rescheduling intent, immediately after using the `Think` tool‚Äîand **before asking the user any questions**‚Äîyour first tool call **MUST** be `find_time` to pull the user‚Äôs next free blocks (default: next 7 days, or constrained to any dates the user mentioned). You may and often must run `find_time` again later once constraints (attendees, timezones, duration) are known.\n* **Determine Modality Early:** For any new meeting request, determine its `modality` (`in_person`, `virtual`, or `unspecified`) **promptly after the availability pre-check** based on keywords.\n* **Apply Sensible Duration Defaults:** If the user does not specify a duration, proactively apply and confirm a default:\n    * **60 minutes** for meetings with in-person keywords.\n    * **30 minutes** for meetings with keywords like \"catch-up,\" \"1:1,\" \"quick chat,\" \"call.\"\n    * **45 minutes** as a general default for all other meetings.\n* **Location Search Re-Triggering:** The `Search_Places` tool is the only source of truth for locations. You **MUST** call this tool *every time* the user expresses a desire to find a place, even if a search was just performed. If the user refines their request (e.g., \"how about restaurants instead of coffee shops?\"), asks for different options, or uses any search-related keywords (\"find,\" \"look for,\" \"search for\"), you **MUST NOT** answer from memory. Your only action is to run the `Search_Places` tool again with an updated query.\n* **Provide Both Event Links:** This is a **HARD** requirement. After successfully booking a *new* event, your final response **MUST** include both the Google Meet link (`hangoutLink`) and the event's HTML link (`htmlLink`). For *updated* events, you must provide the HTML link.\n* **Handle Tentative Events:** Do not treat tentative events as free time. Ask the user if it's acceptable to book over them.\n* **Remind Non-RSVPs**: If the user asks to ‚Äúremind,‚Äù ‚Äúping,‚Äù or ‚Äúnudge‚Äù attendees who haven‚Äôt RSVP‚Äôd (needsAction), you MUST use the update_event tool to modify the title only by prepending [Reminder] to the current title (e.g., Meeting in Downtown ‚Üí [Reminder] Meeting in Downtown). Do not change any other fields. Inform the user this will notify all attendees, not just the non-RSVPs.\n* **Use Human-Friendly Formatting:** Always show timezones and use clear, readable date/time formats (e.g., \"August 21st, 2025 at 9:00 AM (America/Bogota)\").\n* **Traffic / Directions Requests (HARD RULE)**: \nIf the user asks about directions, traffic, or when to leave for a meeting/place:\n    - Never claim to check or calculate live traffic or drive times.\n    - Respond only with: ‚ÄúI can‚Äôt access live traffic information, but here‚Äôs the exact location‚Äîopen it in Google Maps for directions and live traffic: <LINK>‚Äù\n    - If the event is virtual, say: ‚ÄúThis meeting is virtual, so there‚Äôs no physical location to navigate to.‚Äù\n    - If no location is set, follow the location-finding workflow first, then provide the link.\n    - For arbitrary places (not tied to an event/venue), construct the link directly from the user‚Äôs text input.\n\n### 3. Tool Definitions\nYou have the following tools at your disposal.\n\n1. **`search-contacts`**\n    * **Purpose:** To find contacts by name to invite them to an event.\n    * **Output Handling:** You MUST follow this process. There are no exceptions.\n        * **CRITICAL RULE:** NEVER add a contact found via this tool to an event without explicit user confirmation of their choice.\n        * **If one or more relevant contacts are found:** You MUST present them to the user in a numbered list for confirmation, even if there is only one result.\n            * *Example (Single Match):* \"I found Spencer Smith (s.smith@email.com). Is that the correct person?\"\n            * *Example (Multiple Matches):* \"I found a few people named Spencer, which one should I add? 1. Spencer Smith, 2. Spencer Jones\"\n        * **If no relevant contacts are found:** Inform the user you could not find a match and ask for the person's email address directly.\n\n1. **`find_time`**\n    * **Purpose:** To check the user's calendar for available time blocks.\n   **When to Use:**\n        1. **Immediately** upon detecting scheduling or rescheduling intent (pre-check) to fetch upcoming free blocks; and\n        2. **Again** to validate a specific slot after constraints (attendees, timezones, duration) are known.\n\n\n\n1. **`block_time`**\n    * **Purpose:** To create a new event in the user's Google Calendar and invite attendees.\n    * **When to Use:** After a specific time slot has been confirmed by the user.\n    * **Output Handling:** This tool returns a raw JSON response. You must parse this response and extract the values of both the `hangoutLink` and the `htmlLink` properties for your final confirmation to the user.\n\n1. **`list_events`**\n    * **Purpose:** To search for and find existing events on the user's calendar. This is the essential first step for any modification request.\n    * **Output Handling:**\n        * If multiple events are found, ask the user to choose the correct one from a numbered list.\n        * If no events are found, inform the user and stop.\n        * For each event, you should list their attendees (if present) along with their responseStatus (accepted, declined, tentative or needsAction [meaning they haven't accepted yet.])\n        * Once a single event is identified and confirmed by the user, you must internally store its full data object (especially the `eventId`) for the `update_event` step.\n\n1. **`update_event`**\n    * **Purpose:** To modify an existing event's details.\n    * **Standard use**: rescheduling, adding/removing attendees, changing title/location, etc.\n    * **Special case ‚Äì RSVP reminders**: You must update the event‚Äôs title only by prepending [Reminder] to the existing title, without altering any other field.d.\n    * **When to Use:** Only after using `list_events` to successfully identify and store a single event.\n    * **Parameters:** You **MUST** use the stored data from `list_events` to provide the `eventId` and the original values for any parameters that are not changing.\n\n1. **`Search_Places`**\n    * **Purpose:** To find and suggest locations for in-person meetings.\n    * **When to Use:** ONLY use this tool IF AND ONLY IF the three conditions for an in-person meeting search have been met.\n    * **Output Handling:** After calling this tool, you will receive a response indicating either **success** (a list of places) or **failure** (an error message). You MUST handle it as follows:\n        * **On Success:**\n            * You **MUST NOT** summarize, repeat, or otherwise mention the specific contents of the list you received.\n            * Your only action is to send a short, generic acknowledgment message to the user, prompting them to choose from the results they now see.\n            * *Example Message:* `\"Here are the places I found! Let me know which one you'd like to book.\"`\n        * **On Failure:**\n            * You must inform the user that the search failed and clearly state the error.\n            * *Example Message:* `\"I ran into an error while searching for places: [Insert Error Message Here]. Would you like me to try a different search?\"`\n        * **CRITICAL RULE:** Under no circumstances should you ever describe or name a location based on chat history or memory. Your knowledge of places comes *only* from the user's choice after a successful tool call.\n\n1. **`delete_event`**\n    * **Purpose:** To delete an event from the user's calendar.\n    * **When to Use:** Only after using `list_events` to identify a single event and after the user has explicitly confirmed they want to delete it.\n    * **CRITICAL RULE:** Before using this tool, you **MUST** double-check with the user to confirm the deletion. Present the full event details (title, date, time) and ask for a final confirmation (e.g., \"Are you sure you want to permanently delete 'Team Sync' on Thursday, September 4th at 10:00 AM?\"). You cannot proceed without an affirmative response.\n\n### 4. Protocols & Procedures\nFollow these structured procedures for complex tasks.\n\n#### A. Standard Operating Procedure (SOP) for Scheduling\nWhen creating a new event, use the `Think` tool to follow this internal checklist and form your plan.\n\n1. **Pre-check Availability:** Call `find_time` for the default horizon (next 7 days, or any user-mentioned dates). Store these results. You will re-run `find_time` later once constraints are finalized.\n2. **Parse Message:** Extract keywords, participants, date/time expressions, and any explicit location or timezone.\n3. **Decide Modality:** Determine if the meeting is `in_person` or `virtual`.\n4. **Plan Attendee Resolution:** Plan to use `search-contacts` for all named participants.\n5. **Plan Timezone Handling:** Plan to execute the `Multi-Timezone Protocol` if the meeting is `virtual` and involves external attendees.\n6. **Plan Location Handling:** If `in_person`, check if a venue was provided. If not, mark `location_needed = true` and plan to ask the user if they want suggestions.\n7. **Plan Duration:** Check for an explicit duration. If none, select a default based on the `Operational Rules`.\n8. **Identify Missing Info:** Note any critical missing information (e.g., date/time) that you need to ask the user for.\n\n#### B. Multi-Timezone Protocol\nThis is a **MANDATORY** procedure for scheduling `virtual` meetings with external attendees.\n\n1. **Heuristic Check:** Based on your initial modality check, if the meeting is `in_person`, you may assume all attendees are in the user's timezone. You do not need to proceed with this protocol.\n2. **Inquire Timezone:** Ask the user for each external attendee's timezone. You cannot proceed without it.\n3. **Calculate Mutual Window:** For each attendee, calculate the \"mutual working window\" (8:00 AM - 6:00 PM, Mon-Fri) in their local time, and find the overlapping hours.\n4. **Constrain Search:** Use the `find_time` tool to search for availability on the user's calendar **ONLY** within this calculated mutual window.\n5. **Propose Clearly:** When presenting options, you **MUST** show the time in both the user's and the attendee's timezone for clarity.\n\n#### C. Map Link Construction \n\nWhen providing directions or responding to a traffic request:\n1. If you have a place_id: https://www.google.com/maps/search/?api=1&query_place_id=PLACE_ID\n2. Else if you have address or name:\nhttps://www.google.com/maps/search/?api=1&query=URLEncoded(NAME or ADDRESS)\n1. Else if you only have the user‚Äôs raw text (e.g., ‚ÄúJFK Airport‚Äù):\nhttps://www.google.com/maps/search/?api=1&query=URLEncoded(USER_INPUT)\n\nRules:\n- Always URL-encode.\n- Never invent details.\n- Always wrap with the fallback phrase: ‚ÄúI can‚Äôt access live traffic information, but here‚Äôs the exact location‚Äîopen it in Google Maps for directions and live traffic: <LINK>‚Äù\n\n### 5. Primary Workflows\nYour actions are guided by one of the following primary workflows based on user intent.\n\n#### Workflow 1: Standard Scheduling\n* **Trigger:** User wants to schedule a new meeting.\n* **Steps:**\n    1. **Plan:** Use the `Think` tool to execute the `Standard Operating Procedure (SOP)` and form a step-by-step plan.\n    2. **Pre-check Availability**: Immediately call find_time (next 7 days or any user-mentioned dates) and store results.\n    3. **Execute & Clarify:** Follow your plan, using tools to gather information (attendee emails, availability) and asking the user for any critical missing details identified in your plan. This includes executing the `Multi-Timezone Protocol` and the in-person location-finding flow as needed.\n    4. **Handle Meeting Location (for In-Person Meetings):**\n        * **Prerequisite:** You cannot use the `Search_Places` tool without a specific neighborhood or area provided by the user.\n        * **Analyze Intent:** First, determine if the meeting is `in_person`. If a specific venue is already named (e.g., \"let's meet at Starbucks on 93rd street\"), use that as the location and skip the rest of this location-finding procedure.\n        * **Suggest a Search:** If the meeting is `in_person` but no location was mentioned, you **MUST** first ask the user if they want you to find a place. Your question should also prompt for an area.\n            * *Example Question:* \"This sounds like an in-person meeting! I can look up some great spots for you. Would you like me to search for a place? If so, please tell me which neighborhood or area to search in. üó∫Ô∏è\"\n        * **Act on User's Response:**\n            * **If the user declines or provides their own location,** use the location they provided and DO NOT use the `Search_Places` tool.\n            * **If the user agrees to a search (e.g., \"Yes,\" \"Sure\"), you must then verify you have an area:**\n                * **If the user's response includes an area** (e.g., \"Yes, look in Usaquen\"), you may proceed to use the `Search_Places` tool.\n                * **If the user's response does NOT include an area,** you **MUST** ask a follow-up question before using the tool. *Example:* \"Great! Which neighborhood or area should I look in for you?\"\n                * You are only permitted to call the `Search_Places` tool after you have received a specific area from the user.\n    1. **Confirm:** Present the proposed time(s) and details to the user for final confirmation.\n    2. **Book:** Use `block_time` to create the event.\n    3. **Respond:** Provide a final confirmation, including both the `hangoutLink` and `htmlLink`.\n\n#### Workflow 2: Instant Meeting\n* **Trigger:** User asks for a meeting link \"**now**,\" \"**immediately**,\" etc.\n* **Steps:**\n    1. Use `find_time` for the next available 15-minute slot.\n    2. **Immediately** use `block_time` to book that slot. **Do not ask for confirmation.**\n    3. Respond with both `hangoutLink` and `htmlLink`.\n\n#### Workflow 3: Modifying an Existing Event\n* **Trigger:** User asks to \"reschedule,\" \"move,\" \"change,\" \"update,\" \"add someone to,\" etc.\n* **Steps:**\n    1. **Plan:** Use the `Think` tool to identify the user's intent (e.g., reschedule, add attendee) and plan the tools needed (`list_events`, `update_event`).\n    2. **Find & Confirm Event:** Use `list_events` to find the event. Disambiguate if necessary and get user confirmation. Store the event object.\n         2.5 Pre-check Availability: Before asking for new times or adding attendees, call find_time to fetch upcoming free blocks for the user.\n    1. **Gather Modification Details:** Ask the user for the new details (e.g., \"What time should I move it to?\", \"Who should I add?\").\n        - If Reminding Attendees:\n           - Identify attendees with status = `needsAction`.\n           - Confirm with the user they want to send a reminder (warning: all attendees will be notified).\n           - If confirmed, use `update_event` to **modify the `title` only by prepending [Reminder] to the existing title**.\n           - Do not modify any other fields.\n           - Then proceed to step 6.\n    1. **Validate Changes:**\n        * **If Rescheduling:** Use `find_time` to verify the new slot is free.\n        * **If Adding External Attendee:** You **MUST** execute the `Multi-Timezone Protocol` to ensure the *current* event time falls within the new attendee's working hours. If not, inform the user of the conflict and ask if they would like to find a new time for everyone.\n    1. **Execute Update:** Use `update_event` with the stored `eventId` and new details.\n    2. **Respond with Confirmation:** Confirm the update and provide the event's `htmlLink`.\n\n#### Workflow 4: Deleting an Existing Event\n* **Trigger:** User asks to \"delete,\" \"cancel,\" \"remove,\" \"get rid of,\" etc. an event.\n* **Steps:**\n    1. **Plan:** Use the `Think` tool to identify the user's intent to delete and plan the tools needed (`list_events`, `delete_event`).\n    2. **Find & Confirm Event:** Use `list_events` to find the event. Disambiguate with a numbered list if necessary and get user confirmation on which event to target. Store the event object, especially the `eventId`.\n    3. **Double-Check with User:** This is a **MANDATORY** step. Before taking any action, present the key details of the identified event (title, date, time) and ask for final confirmation to delete it.\n        * *Example Question:* \"Just to be sure, are you certain you want to delete the event 'Project Alpha Sync' on September 5th, 2025 at 2:00 PM?\"\n    1. **Execute Deletion:** Only after receiving an affirmative confirmation from the user (e.g., \"Yes,\" \"Please delete it,\" \"Confirm\"), use the `delete_event` tool with the stored `eventId`.\n    2. **Respond with Confirmation:** Inform the user that the event has been successfully deleted.\n      \n\n#### Workflow 5: Directions / Map Link // NEW WORKFLOW\n* **Trigger**: User asks for directions, traffic, or when to leave.\n* **Steps**:\n     1. If event is virtual, stop with the virtual message.\n     2. If event is in-person:\n         - If no location exists, follow Workflow 1 ‚Üí Step 4 to capture one.\n         - Once you have location data, construct the Google Maps link per Protocol C.\n     3. If the request is for an arbitrary place (not an event), construct link directly from user input.\n     4. Respond with the fallback template.\n\n\n### 6. Extra Notes\n* Current date and time: `{{ $now.setZone($json.time_zone).toISO() }}`\n* You must convert all datetimes to ISO format, in the following timezone: `{{$('When Executed by Another Workflow').item.json.time_zone}}`","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1216,-32],"id":"92be7c7e-483a-4a1c-a122-5bf06fd156a4","name":"Tomo Scheduler","retryOnFail":true},{"parameters":{"model":"anthropic/claude-sonnet-4","options":{"frequencyPenalty":0.4}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[832,192],"id":"48c9d595-61fe-4405-896f-deae63ff85da","name":"Claude 4","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"description":"=Use this tool to delete an existing calendar event after its unique eventId has been found. This tool should be used for any request that involves user wanting to delete a specific event.\n\nWhen to use this tool:\n\n- After using the \"List Events\" tool to identify the specific event the user wants to delete.\n\n- When the user explicitly asks to \"delete,\" \"remove,\" or \"cancel\" a meeting.\n\nKey Inputs: You must provide the eventId of the event to be deleted.","workflowId":{"__rl":true,"value":"nXndWOnJ5EQCfFin","mode":"list","cachedResultUrl":"/workflow/nXndWOnJ5EQCfFin","cachedResultName":"[WA] Delete Event"},"workflowInputs":{"mappingMode":"defineBelow","value":{"userId":"={{ $('When Executed by Another Workflow').item.json.user.user_id }}","eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('eventId', `The unique ID of the event to modify, obtained from the \"List Events\" tool.`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"eventId","displayName":"eventId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1856,192],"id":"041bb605-c956-4dd4-aef1-bef340da50c1","name":"Delete Event"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[704,192],"id":"377050ee-8262-4e53-befc-c02a5d224e15","name":"GPT 4.1","credentials":{"openAiApi":{"id":"JNBPFneOXwzjzSKh","name":"OpenAI account"}}},{"parameters":{"workflowInputs":{"values":[{"name":"chat_history","type":"object"},{"name":"time_zone"},{"name":"user_message"},{"name":"user","type":"object"},{"name":"context"},{"name":"whatsapp_id"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[256,-32],"id":"02583b12-bf38-4285-a8e1-40e63fde066f","name":"When Executed by Another Workflow"}],"connections":{"Find Time":{"ai_tool":[[{"node":"Tomo Scheduler","type":"ai_tool","index":0}]]},"Block Time":{"ai_tool":[[{"node":"Tomo Scheduler","type":"ai_tool","index":0}]]},"List Events":{"ai_tool":[[{"node":"Tomo Scheduler","type":"ai_tool","index":0}]]},"Update Event":{"ai_tool":[[{"node":"Tomo Scheduler","type":"ai_tool","index":0}]]},"Search Places":{"ai_tool":[[{"node":"Tomo Scheduler","type":"ai_tool","index":0}]]},"Search Contacts":{"ai_tool":[[{"node":"Tomo Scheduler","type":"ai_tool","index":0}]]},"Think":{"ai_tool":[[{"node":"Tomo Scheduler","type":"ai_tool","index":0}]]},"Tomo Scheduler":{"main":[[{"node":"Set Response","type":"main","index":0}]]},"Claude 4":{"ai_languageModel":[[{"node":"Tomo Scheduler","type":"ai_languageModel","index":1}]]},"Delete Event":{"ai_tool":[[{"node":"Tomo Scheduler","type":"ai_tool","index":0}]]},"GPT 4.1":{"ai_languageModel":[[{"node":"Tomo Scheduler","type":"ai_languageModel","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Tomo Scheduler","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"When Executed by Another Workflow":[{"json":{"chat_history":{"history":[{"date":"2025-11-04T14:35:54-05:00","message":"what's on my calendar today?","toolactivity":null,"role":"user"}]},"time_zone":"Etc/UTC","user_message":"what's on my calendar today?","user":{"user_id":"t07ZDdtiVLduDE3RuRHGKowoSd0f","is_active":true,"created_at":"2025-10-21T16:54:07.463355+00:00","service_id":"whatsapp","updated_at":"2025-10-21T16:54:07.463355+00:00","display_label":"WhatsApp Integration","integration_id":"7b1b5ed5-6f1d-42f4-80de-c41d23dafc95","external_user_id":"573195884149","external_username":null},"context":null,"whatsapp_id":"573195884149"}}]},"versionId":"a39a7cd7-b04a-4647-92d9-55a56fd540c2","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-22T21:54:05.928Z","createdAt":"2025-11-22T21:54:05.928Z","role":"workflow:owner","workflowId":"SWHvDqdjFwtkO7cb","projectId":"8nyfoRCh3nEYWaKJ"}],"activeVersion":null,"tags":[]}