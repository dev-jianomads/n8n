{"updatedAt":"2025-11-26T22:12:36.475Z","createdAt":"2025-11-26T21:41:39.039Z","id":"M04924mjR4Z4q4WT","name":"[Slack] Send Daily Schedule for Single User","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowId":{"__rl":true,"value":"O0mTOcJxAhV0YuVI","mode":"list","cachedResultUrl":"/workflow/O0mTOcJxAhV0YuVI","cachedResultName":"[TG] Refresh Cached Chat History and Time Zone"},"workflowInputs":{"mappingMode":"defineBelow","value":{"telegramId":"={{ $('Get User\\'s Telegram ID').item.json.external_user_id }}","userId":"={{ $('When Executed by Another Workflow').item.json.id }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1792,-48],"id":"fd73e999-8258-4ca7-8812-3528fc3a6c01","name":"Refresh Caches"},{"parameters":{"workflowId":{"__rl":true,"value":"vMEAaS35KPAgCfnj","mode":"list","cachedResultUrl":"/workflow/vMEAaS35KPAgCfnj","cachedResultName":"[TG] Get Cached Time Zone"},"workflowInputs":{"mappingMode":"defineBelow","value":{"userId":"={{ $json.id }}"},"matchingColumns":["userId"],"schema":[{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-1920,-48],"id":"730155a2-5e94-48d8-8dd4-84b26e6096a3","name":"Get Time Zone"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"c00f72a2-4665-4387-9770-cd2708ebdec0","leftValue":"={{ $now.setZone($('Get Time Zone').item.json.timeZone).hour }}","rightValue":8,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1248,-48],"id":"f4de653c-aefe-4faa-93f2-d1b2e068c344","name":"8 AM in Local Zone?"},{"parameters":{"model":"google/gemini-2.5-flash","options":{"temperature":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-576,400],"id":"9dc7ad1f-4c69-4c83-be2a-b21fc7b05359","name":"Gemini 2.5 Flash","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"numberInputs":3,"rules":{"rule":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe59aac6-c1b6-4b01-a2c5-57242f67754f","leftValue":"={{ $('Set Random Index').item.json.model_index }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"}},{"modelIndex":2,"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a4d64c42-5fee-48ce-ad88-dee0bc253aa7","leftValue":"={{ $('Set Random Index').item.json.model_index }}","rightValue":1,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"}},{"modelIndex":3,"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1ca1ec11-df03-4a78-9362-63f7660874fa","leftValue":"={{ $('Set Random Index').item.json.model_index }}","rightValue":2,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"}}]}},"type":"@n8n/n8n-nodes-langchain.modelSelector","typeVersion":1,"position":[-528,192],"id":"e702046b-3019-4812-a419-d7e7155ff634","name":"Model Selector"},{"parameters":{"model":"openai/gpt-5-nano","options":{"temperature":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-448,400],"id":"64850ad1-7038-478c-8134-444917b8cd6e","name":"GPT 5 Nano","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{"temperature":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-320,400],"id":"9301add7-51f2-4b62-ad37-f61b421e6e30","name":"Claude 3.5 Sonnet","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"assignments":{"assignments":[{"id":"c3c836a0-ba65-43ba-bc05-8da2387ed651","name":"model_index","value":"={{ Math.floor(Math.random() * 3) }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-800,-48],"id":"448d2adb-a3c0-4acf-80a8-0f32a8bc8289","name":"Set Random Index"},{"parameters":{"jsonSchemaExample":"{\n  \"morning_message\": \"Rise and shine! Ready to tackle the day?\"\n}","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[-144,192],"id":"6180c52d-2404-40d2-9bd2-6163f562399e","name":"Structured Output Parser"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-144,400],"id":"18f343dc-c2f9-4e77-8d0f-97420fd582d2","name":"4.1 MINI","credentials":{"openAiApi":{"id":"JNBPFneOXwzjzSKh","name":"OpenAI account"}}},{"parameters":{"promptType":"define","text":"=Write a short, warm, and lightly playful good morning message for the person you assist. Keep it under three sentences. Avoid being overly cheerful or awkward. Output only the message text, no placeholders. Tone should balance professional assistant vibes with a friendly sidekick touch.\n\n# Examples:\n\n{\"morning_message\": \"Good morning! May your coffee be strong and your day kinder than expected.\"}\n\n{\"morning_message\": \"Rise and shine—today’s a fresh chance to win some small victories.\"}\n\n{\"morning_message\": \"Morning! Let’s keep today smooth, simple, and maybe even a little fun.\"}\n\n{\"morning_message\": \"Hello, sunshine. Don’t worry, I’ll keep the chaos in check for you.\"}\n\n{\"morning_message\": \"Good morning—let’s make today less about rushing and more about getting it right.\"}","hasOutputParser":true,"needsFallback":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-336,-48],"id":"5653034f-bab0-4062-b3d6-d1d743b6153c","name":"Morning Message Writer","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"KhXkPpKZls1wrj5t","mode":"list","cachedResultUrl":"/workflow/KhXkPpKZls1wrj5t","cachedResultName":"[Slack] Slack Tomo Scheduler"},"workflowInputs":{"mappingMode":"defineBelow","value":{"chat_history":"={{  }}","time_zone":"={{ $('Get Time Zone').first().json.timeZone }}","user_message":"How does my day look like?","user":"={{ $('When Executed by Another Workflow').first().json }}","slack_user_id":"={{ $('Get Slack Integration for User').first().json.get_slack_integration_by_user_id.slack_user_id }}"},"matchingColumns":[],"schema":[{"id":"chat_history","displayName":"chat_history","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object"},{"id":"time_zone","displayName":"time_zone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_message","displayName":"user_message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user","displayName":"user","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object"},{"id":"context","displayName":"context","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"slack_user_id","displayName":"slack_user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"channel_id","displayName":"channel_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true},{"id":"message_ts","displayName":"message_ts","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{"waitForSubWorkflow":true}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[448,-48],"id":"b7d35af2-65eb-4459-92cc-9de848704559","name":"Call Scheduler Agent"},{"parameters":{"workflowId":{"__rl":true,"value":"B4R5PCXZUaCSSdbV","mode":"list","cachedResultUrl":"/workflow/B4R5PCXZUaCSSdbV","cachedResultName":"[TG] Send Telegram Message"},"workflowInputs":{"mappingMode":"defineBelow","value":{"message":"={{ $json.response }}","telegramId":"={{ $('Get User\\'s Telegram ID').item.json.external_user_id }}","chatId":"={{ $('Get User\\'s Telegram ID').item.json.external_user_id }}","toolActivity":"={{ $json.toolActivity ?? [] }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"message","displayName":"message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatId","displayName":"chatId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"toolActivity","displayName":"toolActivity","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1120,-112],"id":"76445959-b366-4827-abdf-6a213d3f2bf3","name":"Send Weather Info (TG)","onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"B4R5PCXZUaCSSdbV","mode":"list","cachedResultUrl":"/workflow/B4R5PCXZUaCSSdbV","cachedResultName":"[TG] Send Telegram Message"},"workflowInputs":{"mappingMode":"defineBelow","value":{"message":"={{ $('Call Scheduler Agent').item.json.response }}","telegramId":"={{ $('Get User\\'s Telegram ID').item.json.external_user_id }}","chatId":"={{ $('Get User\\'s Telegram ID').item.json.external_user_id }}","toolActivity":"={{ $('Call Scheduler Agent').item.json.toolActivity ?? [] }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"message","displayName":"message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatId","displayName":"chatId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"toolActivity","displayName":"toolActivity","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1344,-48],"id":"2eea5074-10d9-4f8c-af1a-fb128dc21615","name":"Send Daily Schedule Telegram Message","onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":false,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4ef51d5b-541b-4466-a5bd-24a7a7b2b698","leftValue":"={{ $json.response }}","rightValue":"NONE","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{"ignoreCase":true}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[896,-48],"id":"f9c2b3a2-e32e-4eb9-9e13-6496d37edfc7","name":"Response?"},{"parameters":{"inputSource":"passthrough"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-2144,-48],"id":"c32cec3d-4d18-42a1-bff4-71e6bc0db024","name":"When Executed by Another Workflow"},{"parameters":{"operation":"rowNotExists","dataTableId":{"__rl":true,"value":"1azZ8CNPFsyyNrh8","mode":"list","cachedResultName":"daily_reports_sent","cachedResultUrl":"/projects/8nyfoRCh3nEYWaKJ/datatables/1azZ8CNPFsyyNrh8"},"matchType":"allConditions","filters":{"conditions":[{"keyName":"user_id","keyValue":"={{ $('When Executed by Another Workflow').first().json.id }}"},{"keyName":"report_local_date","keyValue":"={{ $today.setZone($('Get Time Zone').first().json.timeZone).toLocaleString() }}"},{"keyName":"environment","keyValue":"prod"},{"keyName":"service","keyValue":"slack"}]}},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[-1024,-48],"id":"7f045edd-df68-4bcf-a9d1-2ff2d80a944f","name":"If row does not exist"},{"parameters":{"dataTableId":{"__rl":true,"value":"1azZ8CNPFsyyNrh8","mode":"list","cachedResultName":"daily_reports_sent","cachedResultUrl":"/projects/8nyfoRCh3nEYWaKJ/datatables/1azZ8CNPFsyyNrh8"},"columns":{"mappingMode":"defineBelow","value":{"user_id":"={{ $('When Executed by Another Workflow').item.json.id }}","environment":"prod","tz_at_send":"={{ $('Get Time Zone').item.json.timeZone }}","report_local_date":"={{ $today.setZone($('Get Time Zone').item.json.timeZone).toLocaleString() }}"},"matchingColumns":[],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"tz_at_send","displayName":"tz_at_send","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"environment","displayName":"environment","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"report_local_date","displayName":"report_local_date","required":false,"defaultMatch":false,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.dataTable","typeVersion":1,"position":[1568,-48],"id":"c16828b4-0360-423b-9ab7-27e041361726","name":"Insert row"},{"parameters":{"operation":"executeQuery","query":"SELECT public.get_slack_integration_by_user_id('{{ $('When Executed by Another Workflow').item.json.id }}');","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1696,-48],"id":"113223b7-04fd-4273-a06b-6aa4f58b8faf","name":"Get Slack Integration for User","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e2e8c4eb-4bb8-4e47-a438-52b1a18c0cc9","leftValue":"={{ $json.get_slack_integration_by_user_id !== null && $json.get_slack_integration_by_user_id !== \"null\" }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1472,-48],"id":"a584ee50-f7c0-4776-9447-bceec6c82304","name":"Exists?"},{"parameters":{"workflowId":{"__rl":true,"value":"dl7Ouu4fFql85VAB","mode":"list","cachedResultUrl":"/workflow/dl7Ouu4fFql85VAB","cachedResultName":"[Slack] Send Message"},"workflowInputs":{"mappingMode":"defineBelow","value":{"save":false,"slack_user_id":"={{ $('Get Slack Integration for User').item.json.get_slack_integration_by_user_id.slack_user_id }}","text":"={{ $json.output.morning_message }}"},"matchingColumns":[],"schema":[{"id":"slack_user_id","displayName":"slack_user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"text","displayName":"text","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"save","displayName":"save","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"boolean","removed":false},{"id":"tool_activity","displayName":"tool_activity","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":true}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[224,-112],"id":"334348c1-d14a-4192-a21b-48a8fcbc1346","name":"Send Good Morning Message (Slack)","onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"1Bf1FtaUC4GEY3hs","mode":"list","cachedResultUrl":"/workflow/1Bf1FtaUC4GEY3hs","cachedResultName":"[TG] Get Weather Report"},"workflowInputs":{"mappingMode":"defineBelow","value":{"scheduler_response":"={{ $json.response }}"},"matchingColumns":["scheduler_response"],"schema":[{"id":"scheduler_response","displayName":"scheduler_response","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.3,"position":[672,-48],"id":"68125141-bc34-4fe1-9d89-20f0b4c29f1a","name":"Call 'Get Weather Report'"}],"connections":{"Get Time Zone":{"main":[[{"node":"Get Slack Integration for User","type":"main","index":0}]]},"8 AM in Local Zone?":{"main":[[{"node":"If row does not exist","type":"main","index":0}],[{"node":"If row does not exist","type":"main","index":0}]]},"Gemini 2.5 Flash":{"ai_languageModel":[[{"node":"Model Selector","type":"ai_languageModel","index":0}]]},"Model Selector":{"ai_languageModel":[[{"node":"Morning Message Writer","type":"ai_languageModel","index":0}]]},"GPT 5 Nano":{"ai_languageModel":[[{"node":"Model Selector","type":"ai_languageModel","index":1}]]},"Claude 3.5 Sonnet":{"ai_languageModel":[[{"node":"Model Selector","type":"ai_languageModel","index":2}]]},"Set Random Index":{"main":[[{"node":"Morning Message Writer","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Morning Message Writer","type":"ai_outputParser","index":0}]]},"4.1 MINI":{"ai_languageModel":[[{"node":"Structured Output Parser","type":"ai_languageModel","index":0},{"node":"Morning Message Writer","type":"ai_languageModel","index":1}]]},"Morning Message Writer":{"main":[[{"node":"Send Good Morning Message (Slack)","type":"main","index":0}],[{"node":"Call Scheduler Agent","type":"main","index":0}]]},"Call Scheduler Agent":{"main":[[{"node":"Call 'Get Weather Report'","type":"main","index":0}]]},"Send Weather Info (TG)":{"main":[[{"node":"Send Daily Schedule Telegram Message","type":"main","index":0}]]},"Send Daily Schedule Telegram Message":{"main":[[{"node":"Insert row","type":"main","index":0}]]},"Response?":{"main":[[{"node":"Send Weather Info (TG)","type":"main","index":0}],[{"node":"Send Daily Schedule Telegram Message","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Get Time Zone","type":"main","index":0}]]},"If row does not exist":{"main":[[{"node":"Set Random Index","type":"main","index":0}]]},"Insert row":{"main":[[{"node":"Refresh Caches","type":"main","index":0}]]},"Get Slack Integration for User":{"main":[[{"node":"Exists?","type":"main","index":0}]]},"Exists?":{"main":[[{"node":"8 AM in Local Zone?","type":"main","index":0}]]},"Send Good Morning Message (Slack)":{"main":[[{"node":"Call Scheduler Agent","type":"main","index":0}]]},"Call 'Get Weather Report'":{"main":[[{"node":"Response?","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"id":"t07ZDdtiVLduDE3RuRHGKowoSd0f","email":"jesus@datasmarts.net","display_name":"Jesus Martinez","created_at":"2025-08-07T23:38:10.933Z","time_zone":null,"position":null,"role":null,"phone_number":"+573195884149","integration_created_at":"2025-08-07T23:38:10.933Z","integration_updated_at":"2025-11-25T23:01:24.709Z"}}]},"versionId":"9a8c1420-8fbe-43ec-9f1c-0038555d723b","triggerCount":0,"shared":[{"updatedAt":"2025-11-26T21:41:39.039Z","createdAt":"2025-11-26T21:41:39.039Z","role":"workflow:owner","workflowId":"M04924mjR4Z4q4WT","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}