{"createdAt":"2025-08-27T21:15:34.896Z","updatedAt":"2025-08-27T21:41:31.481Z","id":"O0mTOcJxAhV0YuVI","name":"[TG] Refresh Cached Chat History and Time Zone","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowId":{"__rl":true,"value":"hcMQex513eYi8K2H","mode":"list","cachedResultName":"[TG] Get Conversation"},"workflowInputs":{"mappingMode":"defineBelow","value":{"telegramId":"={{ $json.telegramId }}"},"matchingColumns":["telegramId"],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-64,-208],"id":"f0849ba0-3ece-47eb-ba2f-d010b690615a","name":"Get Chat History"},{"parameters":{"workflowId":{"__rl":true,"value":"DHcoEXUvqWWKxbZD","mode":"list","cachedResultName":"[TG] Get Time Zone"},"workflowInputs":{"mappingMode":"defineBelow","value":{"chatHistory":"={{ $('Get Chat History').first().json.chat_history }}","userId":"={{ $('When Executed by Another Workflow').item.json.userId }}"},"matchingColumns":[],"schema":[{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatHistory","displayName":"chatHistory","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[160,-112],"id":"bf7f6444-350d-4520-b4b3-43ab656728ae","name":"Get Time Zone"},{"parameters":{"operation":"delete","key":"={{ $('When Executed by Another Workflow').item.json.telegramId }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[160,-304],"id":"72c360bd-fbfd-42c3-8914-3a0594c964d8","name":"Delete Cached Chat History","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"operation":"set","key":"={{ $('When Executed by Another Workflow').item.json.telegramId }}","value":"={{ JSON.stringify($('Get Chat History').first().json.chat_history) }}","expire":true,"ttl":"={{ 1 * 24 * 60 * 60}}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[384,-304],"id":"d503c1ac-035c-4489-bfb8-dcf58ecc703e","name":"Cache Chat History","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"workflowInputs":{"values":[{"name":"telegramId"},{"name":"userId"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-288,-208],"id":"0078cfb5-c926-48bf-99ed-4857f668ed5b","name":"When Executed by Another Workflow"},{"parameters":{"operation":"delete","key":"={{ $('When Executed by Another Workflow').item.json.telegramId }}_TZ"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[384,-112],"id":"719f8261-4f45-4c31-8dac-8bc99fad4bb6","name":"Delete Cached Time Zone","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"operation":"set","key":"={{ $('When Executed by Another Workflow').item.json.telegramId }}_TZ","value":"={{ $('Get Time Zone').item.json.timeZone }}","expire":true,"ttl":"={{ 1 * 24 * 60 * 60}}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[608,-112],"id":"3c81e993-9881-4b1b-bc86-0dc0994d59c7","name":"Cache Time Zone","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}}],"connections":{"Get Chat History":{"main":[[{"node":"Get Time Zone","type":"main","index":0},{"node":"Delete Cached Chat History","type":"main","index":0}]]},"Get Time Zone":{"main":[[{"node":"Delete Cached Time Zone","type":"main","index":0}]]},"Delete Cached Chat History":{"main":[[{"node":"Cache Chat History","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Get Chat History","type":"main","index":0}]]},"Delete Cached Time Zone":{"main":[[{"node":"Cache Time Zone","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"When Executed by Another Workflow":[{"json":{"telegramId":"8325351367","userId":"eSfqY64uIqfxgvNibRiXIWVS4JPw"}}]},"versionId":"00cf9efe-d814-4a02-a6fb-69c5eee53b2c","triggerCount":0,"shared":[{"createdAt":"2025-08-27T21:15:34.896Z","updatedAt":"2025-08-27T21:15:34.896Z","role":"workflow:owner","workflowId":"O0mTOcJxAhV0YuVI","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}