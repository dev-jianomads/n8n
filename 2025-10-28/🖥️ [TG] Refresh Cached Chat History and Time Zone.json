{"updatedAt":"2025-10-23T17:32:24.939Z","createdAt":"2025-08-28T21:47:58.831Z","id":"k1DGWUkYJAlFS4iw","name":"üñ•Ô∏è [TG] Refresh Cached Chat History and Time Zone","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowId":{"__rl":true,"value":"eHXJ67uWUIoAqTmg","mode":"list","cachedResultUrl":"/workflow/eHXJ67uWUIoAqTmg","cachedResultName":"üñ•Ô∏è [TG] Get Conversation"},"workflowInputs":{"mappingMode":"defineBelow","value":{"telegramId":"={{ $json.telegramId }}"},"matchingColumns":["telegramId"],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-64,-208],"id":"3d7dd2b5-8361-4b9d-a2db-6f7175a16eb6","name":"Get Chat History"},{"parameters":{"workflowId":{"__rl":true,"value":"DHcoEXUvqWWKxbZD","mode":"list","cachedResultUrl":"/workflow/DHcoEXUvqWWKxbZD","cachedResultName":"üñ•Ô∏è [TG] Get Time Zone"},"workflowInputs":{"mappingMode":"defineBelow","value":{"userId":"={{ $('When Executed by Another Workflow').item.json.userId }}"},"matchingColumns":["userId"],"schema":[{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[384,-112],"id":"8fbc33e9-6160-46e1-91c0-035a3b70c687","name":"Get Time Zone"},{"parameters":{"operation":"delete","key":"={{ $('When Executed by Another Workflow').item.json.telegramId }}_DEV"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[160,-304],"id":"9c16ba16-4e09-4c43-91bd-89abe735369b","name":"Delete Cached Chat History","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"operation":"set","key":"={{ $('When Executed by Another Workflow').item.json.telegramId }}_DEV","value":"={{ JSON.stringify($('Get Chat History').first().json.chat_history) }}","expire":true,"ttl":"={{ 1 * 24 * 60 * 60}}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[384,-304],"id":"2f3ed170-abd7-45a1-9c52-b6212a0b2624","name":"Cache Chat History","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"workflowInputs":{"values":[{"name":"telegramId"},{"name":"userId"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-288,-208],"id":"7c8ede95-7505-44fe-ac73-261239728729","name":"When Executed by Another Workflow"},{"parameters":{"operation":"delete","key":"={{ $('When Executed by Another Workflow').item.json.telegramId }}_TZ_DEV"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[608,-112],"id":"46d31055-8635-4fce-b508-eeee564c2be0","name":"Delete Cached Time Zone","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"operation":"set","key":"={{ $('When Executed by Another Workflow').item.json.telegramId }}_TZ_DEV","value":"={{ $('Get Time Zone').item.json.time_zone }}","expire":true,"ttl":"={{ 1 * 24 * 60 * 60}}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[832,-112],"id":"e8981675-7137-4614-9a43-04f531af616e","name":"Cache Time Zone","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"operation":"get","propertyName":"currentTimeZone","key":"={{ $('When Executed by Another Workflow').item.json.telegramId }}_TZ_DEV","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[160,-112],"id":"9298e3b5-9a2b-4634-9909-9ab12c7b3480","name":"Get TZ","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}}],"connections":{"Get Chat History":{"main":[[{"node":"Delete Cached Chat History","type":"main","index":0},{"node":"Get TZ","type":"main","index":0}]]},"Get Time Zone":{"main":[[{"node":"Delete Cached Time Zone","type":"main","index":0}]]},"Delete Cached Chat History":{"main":[[{"node":"Cache Chat History","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Get Chat History","type":"main","index":0}]]},"Delete Cached Time Zone":{"main":[[{"node":"Cache Time Zone","type":"main","index":0}]]},"Get TZ":{"main":[[{"node":"Get Time Zone","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"When Executed by Another Workflow":[{"json":{"telegramId":"1598386790","userId":"t07ZDdtiVLduDE3RuRHGKowoSd0f"}}]},"versionId":"fda048b6-60e4-48db-9cb6-8c802501f442","triggerCount":0,"shared":[{"updatedAt":"2025-08-28T21:47:58.831Z","createdAt":"2025-08-28T21:47:58.831Z","role":"workflow:owner","workflowId":"k1DGWUkYJAlFS4iw","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}