{"updatedAt":"2025-07-04T22:48:41.109Z","createdAt":"2025-06-03T14:21:07.867Z","id":"kQrWTPmvEFNYzeBm","name":"Send Draft Response","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"send-draft","authentication":"headerAuth","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[200,180],"id":"b0937e93-5c38-413c-bc4f-b447a35aee73","name":"Webhook","webhookId":"b3105595-addd-48cf-8689-dbebd18a4584","credentials":{"httpHeaderAuth":{"id":"kpchGH0oruKJ0XiH","name":"JIA Authorization Header Auth"}}},{"parameters":{"operation":"get","tableId":"tasks","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $json.taskId }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[420,180],"id":"aca3ddec-f881-4de7-be58-2da87888f5b5","name":"Get Task","credentials":{"supabaseApi":{"id":"PwJN4yKDRZqivq2f","name":"Supabase account"}}},{"parameters":{"workflowId":{"__rl":true,"value":"5nLuIwEVYbgbkXK2","mode":"list","cachedResultName":"Get Token"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"={{ $json.user_id }}"},"matchingColumns":["user_id"],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[640,180],"id":"5fe6fc7b-76a8-4f17-84ce-f1e3485a58a1","name":"Get Token & User"},{"parameters":{"operation":"get","tableId":"emails","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $('Get Task').item.json.extracted_from_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[860,180],"id":"389cbdeb-a3ad-4400-8a04-9128a52cd3d3","name":"Get Email","credentials":{"supabaseApi":{"id":"PwJN4yKDRZqivq2f","name":"Supabase account"}}},{"parameters":{"assignments":{"assignments":[{"id":"32827dc5-13e3-4920-b4e2-d9211af77334","name":"to","value":"={{ ( ($('Webhook').item.json.emaillist ?? []).concat([$json.sender_email]) ).unique() }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1080,180],"id":"6293c0cf-1600-414b-82cf-29ab80679a6a","name":"Set Recipients"},{"parameters":{"assignments":{"assignments":[{"id":"5b0eb5a8-72e1-4902-b5eb-aa412370d994","name":"content","value":"=To: {{ $json.to.join(\",\") }}\nFrom: {{ $('Get Token & User').item.json.user.email }}\nSubject: Re: {{ $('Get Email').item.json.subject }}\nContent-Type: text/plain; charset=\"\"UTF-8\"\"\n\n{{ $('Get Task').item.json.draft_response }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1300,180],"id":"0371f117-994b-4097-b51f-0dd9e51d1ddc","name":"Set Email Content"},{"parameters":{"method":"POST","url":"https://gmail.googleapis.com/gmail/v1/users/me/messages/send","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"=Bearer {{ $('Get Token & User').item.json.accessToken }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"raw","value":"={{ $json.base64 }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1740,180],"id":"f0d0da73-ce8b-49b2-93ba-8fda66180072","name":"Send Email"},{"parameters":{"respondWith":"json","responseBody":"{\"message\": \"Email sent successfully\"}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1960,180],"id":"daee9771-0d17-402a-b9db-bd63bd2b6cbe","name":"Respond to Webhook"},{"parameters":{"jsCode":"const base64 = Buffer.from($input.first().json.content).toString('base64');\nreturn {json: {base64} };"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1520,180],"id":"1b28a563-60b5-45d0-a821-c62877e84e84","name":"Compute Base64"}],"connections":{"Webhook":{"main":[[{"node":"Get Task","type":"main","index":0}]]},"Get Task":{"main":[[{"node":"Get Token & User","type":"main","index":0}]]},"Get Token & User":{"main":[[{"node":"Get Email","type":"main","index":0}]]},"Get Email":{"main":[[{"node":"Set Recipients","type":"main","index":0}]]},"Set Recipients":{"main":[[{"node":"Set Email Content","type":"main","index":0}]]},"Set Email Content":{"main":[[{"node":"Compute Base64","type":"main","index":0}]]},"Send Email":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Compute Base64":{"main":[[{"node":"Send Email","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"255b11ff-8898-4cbf-9715-12e2acb97bc2","triggerCount":1,"shared":[{"updatedAt":"2025-06-03T14:21:07.867Z","createdAt":"2025-06-03T14:21:07.867Z","role":"workflow:owner","workflowId":"kQrWTPmvEFNYzeBm","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}