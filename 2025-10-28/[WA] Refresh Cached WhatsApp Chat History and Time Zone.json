{"updatedAt":"2025-10-28T20:04:24.774Z","createdAt":"2025-10-28T19:53:59.932Z","id":"xjeiN435FRXPWLFI","name":"[WA] Refresh Cached WhatsApp Chat History and Time Zone","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowId":{"__rl":true,"value":"ztghoamaVYoATerm","mode":"list","cachedResultUrl":"/workflow/ztghoamaVYoATerm","cachedResultName":"[WA] Get WhatsApp Conversation"},"workflowInputs":{"mappingMode":"defineBelow","value":{"whatsAppId":"={{ $json.whatsAppId }}"},"matchingColumns":["whatsAppId"],"schema":[{"id":"whatsAppId","displayName":"whatsAppId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-496,0],"id":"004b0c14-c40f-4812-93ea-b858d98dcd59","name":"Get Chat History"},{"parameters":{"workflowId":{"__rl":true,"value":"d7PDXuxH12xsDziS","mode":"list","cachedResultUrl":"/workflow/d7PDXuxH12xsDziS","cachedResultName":"[WA] Get WhatsApp Time Zone [TO-DO]"},"workflowInputs":{"mappingMode":"defineBelow","value":{"userId":"={{ $('When Executed by Another Workflow').item.json.userId }}"},"matchingColumns":["userId"],"schema":[{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-48,96],"id":"fea8a23f-a310-426f-9a59-4660b5d8bd66","name":"Get Time Zone"},{"parameters":{"operation":"delete","key":"={{ $('When Executed by Another Workflow').item.json.whatsAppId }}_WA"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-272,-96],"id":"15c88956-038f-4a82-b0cc-6ce94a00055f","name":"Delete Cached Chat History","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"operation":"set","key":"={{ $('When Executed by Another Workflow').item.json.whatsAppId }}_WA","value":"={{ JSON.stringify($('Get Chat History').first().json.chat_history) }}","expire":true,"ttl":"={{ 1 * 24 * 60 * 60}}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-48,-96],"id":"96fae5f2-eeb6-4c66-9102-9933076b1855","name":"Cache Chat History","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"workflowInputs":{"values":[{"name":"whatsAppId"},{"name":"userId"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-720,0],"id":"ffd4dd3b-6729-4264-98aa-69c2c1b46ce5","name":"When Executed by Another Workflow"},{"parameters":{"operation":"delete","key":"={{ $('When Executed by Another Workflow').item.json.whatsAppId }}_TZ_WA"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[176,96],"id":"3e7752db-c13d-429d-950d-67910d68033e","name":"Delete Cached Time Zone","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"operation":"set","key":"={{ $('When Executed by Another Workflow').item.json.whatsAppId }}_TZ_WA","value":"={{ $('Get Time Zone').item.json.time_zone }}","expire":true,"ttl":"={{ 1 * 24 * 60 * 60}}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[400,96],"id":"35a2e395-aa34-4aa6-86a7-074d923a58f5","name":"Cache Time Zone","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"operation":"get","propertyName":"currentTimeZone","key":"={{ $('When Executed by Another Workflow').item.json.whatsAppId }}_TZ_WA","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-272,96],"id":"6c2063e0-c6ea-4a62-a907-e89ffddb50ef","name":"Get TZ","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}}],"connections":{"Get Chat History":{"main":[[{"node":"Delete Cached Chat History","type":"main","index":0},{"node":"Get TZ","type":"main","index":0}]]},"Get Time Zone":{"main":[[{"node":"Delete Cached Time Zone","type":"main","index":0}]]},"Delete Cached Chat History":{"main":[[{"node":"Cache Chat History","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Get Chat History","type":"main","index":0}]]},"Delete Cached Time Zone":{"main":[[{"node":"Cache Time Zone","type":"main","index":0}]]},"Get TZ":{"main":[[{"node":"Get Time Zone","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"When Executed by Another Workflow":[{"json":{"whatsAppId":"573195884149","userId":"t07ZDdtiVLduDE3RuRHGKowoSd0f"}}]},"versionId":"e27faf64-93e6-4da2-ac03-345ab84c31db","triggerCount":0,"shared":[{"updatedAt":"2025-10-28T19:53:59.932Z","createdAt":"2025-10-28T19:53:59.932Z","role":"workflow:owner","workflowId":"xjeiN435FRXPWLFI","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}