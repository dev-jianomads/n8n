{"createdAt":"2025-05-29T16:21:22.908Z","updatedAt":"2025-06-03T14:16:45.151Z","id":"hP5sYnXKqZHAcYaY","name":"3. Create Tasks from Email","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"email","type":"object"},{"name":"user","type":"object"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1880,380],"id":"e07941db-8699-49bf-ba8e-1c7407fdc954","name":"When Executed by Another Workflow"},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"threadEmails","include":"specifiedFields","fieldsToInclude":"body,date_received","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-560,380],"id":"8c32b822-7156-4283-a3af-2384351b484d","name":"Aggregate Thread"},{"parameters":{"workflowId":{"__rl":true,"value":"a6Rd7Rwim39dGqoM","mode":"list","cachedResultName":"🤖 Extract Tasks From Email Body"},"workflowInputs":{"mappingMode":"defineBelow","value":{"blacklistedApps":"={{ $('Set Irrelevant Apps').item.json.irrelevantApps }}","sender":"={{ $('When Executed by Another Workflow').first().json.email.sender_email }}","senderName":"={{ $('When Executed by Another Workflow').first().json.email.sender_name }}","subject":"={{ $('When Executed by Another Workflow').first().json.email.subject }}","recipientEmail":"={{ $('When Executed by Another Workflow').first().json.user.email }}","recipientName":"={{ $('When Executed by Another Workflow').first().json.user.display_name }}","emailDate":"={{ $('When Executed by Another Workflow').first().json.email.date_received }}","body":"={{ $('When Executed by Another Workflow').first().json.email.body }}","threadEmails":"={{ $json.threadEmails }}"},"matchingColumns":[],"schema":[{"id":"blacklistedApps","displayName":"blacklistedApps","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array"},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"senderName","displayName":"senderName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"subject","displayName":"subject","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientEmail","displayName":"recipientEmail","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientName","displayName":"recipientName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"emailDate","displayName":"emailDate","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"body","displayName":"body","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"threadEmails","displayName":"threadEmails","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array"}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-340,380],"id":"72194fde-dbb8-471d-9ca2-ef948320b92d","name":"Extract Tasks from Email Body"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fc3f9057-2d08-4d5a-aac0-2628c6e92688","leftValue":"={{ $json.extractedTasks.tasks }}","rightValue":1,"operator":{"type":"array","operation":"lengthGt","rightType":"number"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-120,380],"id":"b21bc326-2bb2-4992-9fe0-d03a24f9d62e","name":"Multiple tasks?"},{"parameters":{"workflowId":{"__rl":true,"value":"Vg55A0mxC7AIO0xQ","mode":"list","cachedResultName":"🤖 Merge Tasks"},"workflowInputs":{"mappingMode":"defineBelow","value":{"tasks":"={{ $json.extractedTasks.tasks }}"},"matchingColumns":["tasks"],"schema":[{"id":"tasks","displayName":"tasks","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[80,280],"id":"484d730a-3fef-4449-aa02-a8a780f2cdf8","name":"Merge Tasks"},{"parameters":{"assignments":{"assignments":[{"id":"db230891-2ce4-42b3-8010-c66a2ebfd05f","name":"tasks","value":"={{ $json.tasks }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[320,380],"id":"b3a2911b-cf83-4b37-934b-0316e771405f","name":"Set Tasks"},{"parameters":{"fieldToSplitOut":"tasks","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[540,380],"id":"22b79b92-1404-4f62-940c-cc424fcd6444","name":"Split Out"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[760,380],"id":"ab985607-e471-44de-9583-2b125dad4ffa","name":"Loop Over Items"},{"parameters":{"assignments":{"assignments":[{"id":"de7da724-a982-4109-bb01-7684f6fd5cb4","name":"priority","value":"={{ $json.priority ?? \"low\" }}","type":"string"},{"id":"abf867ba-aa18-42b7-b5d6-74e5d95b08de","name":"category","value":"={{ $json.category.toLowerCase() ?? \"reply\" }}","type":"string"},{"id":"3cb7577b-5e71-43b4-b740-e21412c31449","name":"due_date","value":"={{ $json.due_date == \"today\" ? $now.toUTC().toISO() : $json.due_date }}","type":"string"},{"id":"882ce4ea-7507-49f5-aefa-698685f096c2","name":"created_at","value":"={{ $now.toUTC().toISO() }}","type":"string"},{"id":"132d6e39-a5fd-4491-a2d0-3d996cd873e8","name":"user_id","value":"={{ $('When Executed by Another Workflow').first().json.user.id }}","type":"string"},{"id":"6aecce0f-fff3-49fe-9a64-b06825c04fb3","name":"email_id","value":"={{ $('When Executed by Another Workflow').first().json.email.email_id }}","type":"string"},{"id":"853efffc-a02e-426e-8112-094b906a0dbc","name":"description","value":"={{ $json.description ?? $('When Executed by Another Workflow').first().json.email.subject }}","type":"string"},{"id":"079359da-3efb-4b09-b366-8638e4327929","name":"extracted_from_id","value":"={{ $('When Executed by Another Workflow').first().json.email.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[980,300],"id":"468b23e7-50da-4b1c-8189-88fcfb1e2d92","name":"Set DB Task Fields"},{"parameters":{"action":"generate","dataPropertyName":"task_id"},"type":"n8n-nodes-base.crypto","typeVersion":1,"position":[1200,300],"id":"ed5486da-20b8-441e-ab07-99b3b133ceb7","name":"Generate Task ID"},{"parameters":{"assignments":{"assignments":[{"id":"5683ea4e-de11-453a-9c76-f1d72312a365","name":"app_name","value":"={{ $json.deep_link.app_name ?? \"\" }}","type":"string"},{"id":"cb8bbdb5-2ff0-4b46-a746-c31fa03c0ef5","name":"link","value":"={{ $json.deep_link.link.replaceAll(\"\\\"\", \"\") ?? \"\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1640,300],"id":"6f9fb0f3-15f8-4f1d-a148-1d30712cc9c5","name":"Set Link Data"},{"parameters":{"workflowId":{"__rl":true,"value":"N25yWYIsirJDXP9r","mode":"list","cachedResultName":"🤖 Draft Response"},"workflowInputs":{"mappingMode":"defineBelow","value":{"type":"={{ $('Generate Task ID').item.json.category }}","taskDescription":"={{ $('Generate Task ID').item.json.description }}","recipientName":"={{ $('When Executed by Another Workflow').first().json.user.display_name }}","senderName":"={{ $('When Executed by Another Workflow').first().json.email.sender_name }}","body":"={{ $('When Executed by Another Workflow').first().json.email.body }}","threadSummary":"={{ $('Get Thread').item.json.summary }}"},"matchingColumns":[],"schema":[{"id":"type","displayName":"type","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"body","displayName":"body","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"threadSummary","displayName":"threadSummary","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"taskDescription","displayName":"taskDescription","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"senderName","displayName":"senderName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientName","displayName":"recipientName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1860,300],"id":"e4b98021-64f7-430b-a112-a7042d3137f0","name":"Draft Response"},{"parameters":{"workflowId":{"__rl":true,"value":"2hOMz3bVWinKdXJF","mode":"list","cachedResultName":"🤖 Create Extended Task Description"},"workflowInputs":{"mappingMode":"defineBelow","value":{"priority":"={{ $('Generate Task ID').item.json.priority }}","taskDescription":"={{ $('Generate Task ID').item.json.description }}","threadSummary":"={{ $('Get Thread').item.json.summary }}","dueDate":"={{ $('Generate Task ID').item.json.due_date }}","senderName":"={{ $('When Executed by Another Workflow').first().json.email.sender_name }}","senderEmail":"={{ $('When Executed by Another Workflow').first().json.email.sender_email }}","body":"={{ $('When Executed by Another Workflow').first().json.email.body }}","subject":"={{ $('When Executed by Another Workflow').first().json.email.subject }}","recipientName":"={{ $('When Executed by Another Workflow').first().json.user.display_name }}","recipientEmail":"={{ $('When Executed by Another Workflow').first().json.user.email }}"},"matchingColumns":[],"schema":[{"id":"subject","displayName":"subject","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"body","displayName":"body","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"threadSummary","displayName":"threadSummary","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"taskDescription","displayName":"taskDescription","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"dueDate","displayName":"dueDate","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"priority","displayName":"priority","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"senderName","displayName":"senderName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"senderEmail","displayName":"senderEmail","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientName","displayName":"recipientName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"recipientEmail","displayName":"recipientEmail","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[2080,300],"id":"da1ad5e0-df22-4d2f-b4a6-84fd1b6f3b31","name":"Create Extended Task Description"},{"parameters":{"workflowId":{"__rl":true,"value":"EuLZafJfE68Dr2cC","mode":"list","cachedResultName":"🤖 Extract Links and App Name"},"workflowInputs":{"mappingMode":"defineBelow","value":{"taskDescription":"={{ $json.description }}","subject":"={{ $('When Executed by Another Workflow').first().json.email.subject }}","sender":"={{ $('When Executed by Another Workflow').first().json.email.sender }}","body":"={{ $('When Executed by Another Workflow').first().json.email.body }}"},"matchingColumns":[],"schema":[{"id":"body","displayName":"body","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"sender","displayName":"sender","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"taskDescription","displayName":"taskDescription","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"subject","displayName":"subject","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1420,300],"id":"8d32f021-cf27-4adb-8c94-3d7ac79102ab","name":"Extract Link"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"app_name"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-1440,380],"id":"888fc152-09e8-4a7d-be95-763eec90f25c","name":"Aggregate"},{"parameters":{"assignments":{"assignments":[{"id":"3ab6e524-7f90-4b45-8c1a-007dc5acf22f","name":"irrelevantApps","value":"={{ $json.app_name }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1220,380],"id":"1f57fd8e-380d-408c-a63d-fd1ceb09ca18","name":"Set Irrelevant Apps"},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT(app_name)\nFROM \"public\".\"tasks\"\nWHERE progress = 'deleted'\nAND category = 'app'\nAND app_name <> ''\nAND app_name IS NOT NULL;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1660,380],"id":"88334fba-900d-4adf-81ab-1fcc0ace534d","name":"Find Names of Irrelevant Apps","alwaysOutputData":true,"credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"operation":"executeQuery","query":"SELECT body, date_received\nFROM \"public\".\"emails\"\nWHERE thread_id = '{{ $('When Executed by Another Workflow').item.json.email.thread_id }}'\nORDER BY date_received DESC\nLIMIT 3;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-780,380],"id":"e174d910-ba18-4676-94ab-7b3257fa24bd","name":"Get Emails in Thread","alwaysOutputData":true,"credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"email_threads","mode":"list","cachedResultName":"email_threads"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $('When Executed by Another Workflow').first().json.email.thread_id }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1000,380],"id":"fba78857-ca9a-4839-a045-60fe1ba20523","name":"Get Thread","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"tasks","mode":"list","cachedResultName":"tasks"},"columns":{"mappingMode":"defineBelow","value":{"id":"={{ $('Generate Task ID').item.json.task_id }}","created_at":"={{ $('Generate Task ID').item.json.created_at }}","description":"={{ $('Generate Task ID').item.json.description }}","due_date":"={{ $('Generate Task ID').item.json.due_date }}","category":"={{ $('Generate Task ID').item.json.category }}","priority":"={{ $('Generate Task ID').item.json.priority }}","user_id":"={{ $('Generate Task ID').item.json.user_id }}","email_id":"={{ $('Generate Task ID').item.json.email_id }}","app_name":"={{ $('Set Link Data').item.json.app_name }}","app_link":"={{ $('Set Link Data').item.json.link }}","draft_response":"={{ $('Draft Response').item.json.response }}","extracted_from_id":"={{ $('Generate Task ID').item.json.extracted_from_id }}","description_extended":"={{ $json.description }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"description","displayName":"description","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"due_date","displayName":"due_date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"category","displayName":"category","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"priority","displayName":"priority","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"feedback","displayName":"feedback","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"user_id","displayName":"user_id","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"email_id","displayName":"email_id","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"progress","displayName":"progress","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"app_link","displayName":"app_link","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"app_name","displayName":"app_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"chat_id","displayName":"chat_id","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"draft_response","displayName":"draft_response","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"time_blocked","displayName":"time_blocked","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"user_feedback","displayName":"user_feedback","required":false,"defaultMatch":false,"display":true,"type":"array","canBeUsedToMatch":true,"removed":true},{"id":"extracted_from_id","displayName":"extracted_from_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"description_extended","displayName":"description_extended","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2300,380],"id":"e21932d9-84d4-4ec9-8748-a8ea39ccd5d9","name":"Insert Task","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Find Names of Irrelevant Apps","type":"main","index":0}]]},"Aggregate Thread":{"main":[[{"node":"Extract Tasks from Email Body","type":"main","index":0}]]},"Extract Tasks from Email Body":{"main":[[{"node":"Multiple tasks?","type":"main","index":0}]]},"Multiple tasks?":{"main":[[{"node":"Merge Tasks","type":"main","index":0}],[{"node":"Set Tasks","type":"main","index":0}]]},"Merge Tasks":{"main":[[{"node":"Set Tasks","type":"main","index":0}]]},"Set Tasks":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Set DB Task Fields","type":"main","index":0}]]},"Set DB Task Fields":{"main":[[{"node":"Generate Task ID","type":"main","index":0}]]},"Generate Task ID":{"main":[[{"node":"Extract Link","type":"main","index":0}]]},"Set Link Data":{"main":[[{"node":"Draft Response","type":"main","index":0}]]},"Draft Response":{"main":[[{"node":"Create Extended Task Description","type":"main","index":0}]]},"Create Extended Task Description":{"main":[[{"node":"Insert Task","type":"main","index":0}]]},"Extract Link":{"main":[[{"node":"Set Link Data","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Set Irrelevant Apps","type":"main","index":0}]]},"Set Irrelevant Apps":{"main":[[{"node":"Get Thread","type":"main","index":0}]]},"Find Names of Irrelevant Apps":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Get Emails in Thread":{"main":[[{"node":"Aggregate Thread","type":"main","index":0}]]},"Get Thread":{"main":[[{"node":"Get Emails in Thread","type":"main","index":0}]]},"Insert Task":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"63JMaA3ATIsJVc6Y"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"4974d99f-f9a0-46da-94cc-8b44d77a9340","triggerCount":0,"tags":[]}