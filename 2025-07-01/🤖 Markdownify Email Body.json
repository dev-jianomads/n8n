{"createdAt":"2025-05-29T16:23:59.950Z","updatedAt":"2025-07-01T18:43:25.804Z","id":"6iEsc0mXqPkcn4aa","name":"🤖 Markdownify Email Body","active":false,"isArchived":false,"nodes":[{"parameters":{"mode":"raw","jsonOutput":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1320,100],"id":"0ffac73d-658b-4f6f-9589-ad501fb3722e","name":"Set Response"},{"parameters":{"workflowInputs":{"values":[{"name":"body"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[40,100],"id":"47eeaadc-34e9-456d-bda2-638921c72757","name":"When Executed by Another Workflow"},{"parameters":{"assignments":{"assignments":[{"id":"098d9f2e-e217-4398-bde9-6db676a1e316","name":"system","value":"=**ROLE**  \nYou are a formatting tool. Your sole function is to **convert email content into Markdown**, preserving all original text **exactly as it appears**, while applying structural Markdown formatting **without altering the content in any way**.\n\n\n**OBJECTIVE**  \nTransform the given input (either HTML or plain text email) into valid, clean Markdown.  \n**You must not add, remove, reword, or reinterpret** any part of the content.  \n**Only format what already exists.**\n\n\n**INPUT TYPES**\n\n-   HTML-formatted emails\n    \n-   Plain text emails\n    \n\n**EXPECTED OUTPUT**\n\n-   A single Markdown document that mirrors the original content in structure and meaning.\n    \n-   Do **not** include any HTML.\n    \n-   Do **not** wrap your response in code blocks, quotes, or explanations.\n    \n-   Output **only** the Markdown content.\n    \n\n### FORMATTING RULES\n\n#### If the input is **HTML**:\n\n-   Convert structural elements directly to Markdown:\n    \n    -   Headings:  `#`, `##`, etc. (match level)\n        \n    -   Paragraphs: preserve line breaks\n        \n    -   Lists: `- item` or `1. item` (match input)\n        \n    -   Bold (`<b>`, `<strong>`): `**bold**`\n        \n    -   Italic (`<i>`, `<em>`): `*italic*`\n        \n    -   Links: `[text](URL)`\n        \n    -   Images: `![alt text](src)`\n        \n    -   Tables: Markdown table format\n        \n-   Remove:\n    \n    -   All styles, scripts, inline formatting, and invisible elements\n        \n-   Do **not** infer or rename section headers\n    \n-   Maintain the **original order, spelling, casing, and punctuation**\n    \n\n#### If the input is **plain text**:\n\n-   Apply Markdown formatting **only if clearly indicated by the structure**:\n    \n    -   Bullet or numbered lists → use `-` or `1.`\n        \n    -   Headings (e.g., ALL CAPS lines or lines followed by a separator) → convert to `#` headers _only if obvious_\n        \n    -   Preserve all line breaks, indentation, and spacing\n        \n-   Convert bare URLs to `[URL](URL)` format — but do **not guess link text**\n    \n-   Do **not rephrase or summarize** anything\n    \n-   Do **not infer structure that isn’t already present**\n    \n\n### STRICTLY FORBIDDEN\n\n- Adding or removing any content\n    \n- Paraphrasing or summarizing\n    \n- Making “improvements” or corrections\n    \n- Guessing what the user meant\n    \n- Wrapping output in quotes or code blocks\n\n- Adding ACKNOWLEDGEMENTS, REMARKS or any other COMMENT besides the original content.\n\n- DO NOT PREFACE THE TEXT WITH A HEADER SUCH AS \"# EMAIL BODY\".\n    \n\n### YOUR JOB:\n\n> Output a **pure Markdown version** of the input. The original meaning and wording **must be preserved exactly** — only the formatting is changed.","type":"string"},{"id":"bf63ab0e-8438-4c58-b68c-b84b862a6812","name":"user","value":"=Email Body: {{ $json.body }}","type":"string"},{"id":"bfb36bc6-024d-4caf-89cd-350a12747cb0","name":"temperature","value":0,"type":"number"},{"id":"ec433b14-2ef1-4f54-9ab3-9bc93abd767a","name":"maxTokens","value":4096,"type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[260,100],"id":"5fe39d85-bb29-43b8-9e63-1838ee60ff1e","name":"Set Prompts & Params"},{"parameters":{"jsonSchemaExample":"{\n\"body\": \n\"Hi Ken,\\n\\nYour package has been delivered!\\n\\nTrack your package:  \\n[https://www.amazon.com.au/gp/css/shiptrack/view.html?ie=UTF8&orderID=249-8939637-7152666&orderingShipmentId=44094826193303&packageId=1&ref_=E_301](https://www.amazon.com.au/gp/css/shiptrack/view.html?ie=UTF8&orderID=249-8939637-7152666&orderingShipmentId=44094826193303&packageId=1&ref_=E_301)\\n\\nReturn or replace items in Your Orders: \\n\\n[https://www.amazon.com.au/gp/css/order-history?ie=UTF8&ref_=E_301](https://www.amazon.com.au/gp/css/order-history?ie=UTF8&ref_=E_301)\\n\\n--------------------------------------------------------------------------------------------------------------------------------------------\\nOrder #249-8939637-7152666  \\n[https://www.amazon.com.au/gp/css/summary/edit.html?ie=UTF8&orderID=249-8939637-7152666&ref_=E_301](https://www.amazon.com.au/gp/css/summary/edit.html?ie=UTF8&orderID=249-8939637-7152666&ref_=E_301)\\n\\nSee all orders:\\n\\n[https://www.amazon.com.au/gp/css/order-history?ie=UTF8&ref_=E_301](https://www.amazon.com.au/gp/css/order-history?ie=UTF8&ref_=E_301)  \\nThis email was sent from an email address that can't receive emails. Please don't reply to this email.\"\n}","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[600,322.5],"id":"5398f619-e5e1-40c6-b704-b1011fb24bbc","name":"Structured Output Parser"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{"maxTokens":"={{ $json.maxTokens }}","temperature":"={{ $json.temperature }}"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[680,520],"id":"a2b3cbe8-ee45-4bfc-b5c7-2665d3a2420c","name":"4.1","credentials":{"openAiApi":{"id":"JNBPFneOXwzjzSKh","name":"OpenAi account"}}},{"parameters":{"model":"openai/gpt-4.1","options":{"maxTokens":"={{ $json.maxTokens }}","temperature":"={{ $json.temperature }}"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[480,320],"id":"14bb4efb-5a7d-40fa-aa6a-7726bb252d94","name":"GPT 4.1","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"promptType":"define","text":"={{ $json.user }}","hasOutputParser":true,"options":{"systemMessage":"={{ $json.system }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[500,100],"id":"4da62f10-e61f-4bcb-a738-5cc30d5f305c","name":"Markdownifier","retryOnFail":true,"maxTries":5,"onError":"continueErrorOutput"},{"parameters":{"promptType":"define","text":"={{ $('Set Prompts & Params').item.json.user }}","hasOutputParser":true,"options":{"systemMessage":"={{ $('Set Prompts & Params').item.json.system }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[960,175],"id":"ec39253a-43a3-44d2-b9ed-173c0286b8dc","name":"Markdownifier (Fallback)","retryOnFail":true,"maxTries":5}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Set Prompts & Params","type":"main","index":0}]]},"Set Prompts & Params":{"main":[[{"node":"Markdownifier","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Markdownifier","type":"ai_outputParser","index":0},{"node":"Markdownifier (Fallback)","type":"ai_outputParser","index":0}]]},"4.1":{"ai_languageModel":[[{"node":"Markdownifier (Fallback)","type":"ai_languageModel","index":0},{"node":"Structured Output Parser","type":"ai_languageModel","index":0}]]},"GPT 4.1":{"ai_languageModel":[[{"node":"Markdownifier","type":"ai_languageModel","index":0}]]},"Markdownifier":{"main":[[{"node":"Set Response","type":"main","index":0}],[{"node":"Markdownifier (Fallback)","type":"main","index":0}]]},"Markdownifier (Fallback)":{"main":[[{"node":"Set Response","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"63JMaA3ATIsJVc6Y"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"body":"Hi Ken,\n\nYour package has been delivered!\n\nTrack your package:\nhttps://www.amazon.com.au/gp/css/shiptrack/view.html?ie=UTF8&orderID=249-8939637-7152666&orderingShipmentId=44094826193303&packageId=1&ref_=E_301\n\n\nReturn or replace items in Your Orders: \n\nhttps://www.amazon.com.au/gp/css/order-history?ie=UTF8&ref_=E_301\n\n--------------------------------------------------------------------------------------------------------------------------------------------\nOrder #249-8939637-7152666\nhttps://www.amazon.com.au/gp/css/summary/edit.html?ie=UTF8&orderID=249-8939637-7152666&ref_=E_301\n\nSee all orders:\n\nhttps://www.amazon.com.au/gp/css/order-history?ie=UTF8&ref_=E_301\nThis email was sent from an email address that can't receive emails. Please don't reply to this email."}}]},"versionId":"9efc8bc1-7376-40aa-9ad1-b9bb54f26924","triggerCount":0,"tags":[]}