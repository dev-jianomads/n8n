{"createdAt":"2025-07-03T23:00:29.812Z","updatedAt":"2025-07-07T22:05:51.278Z","id":"qGoVkhfhVEnGUURi","name":"Block Time (Tool)","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"bad8463a-b277-4d37-92c2-7326ecb91c7d","responseMode":"responseNode","options":{"rawBody":false}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-360,40],"id":"1fa3acb0-ebb6-4e35-8c41-a3d18488f127","name":"Webhook","webhookId":"bad8463a-b277-4d37-92c2-7326ecb91c7d"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e79c59e1-a783-4bfb-a60d-ecf4104c8d36","leftValue":"={{ $json.body.task_id }}","rightValue":"","operator":{"type":"string","operation":"notExists","singleValue":true}},{"id":"12fff553-64e2-4a6e-be8b-b87ed6e8943e","leftValue":"={{ $json.body.task_id }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-140,-120],"id":"0d94c3df-82aa-401f-b696-074f013b6bd8","name":"Invalid Task ID?"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e79c59e1-a783-4bfb-a60d-ecf4104c8d36","leftValue":"={{ $json.body.start }}","rightValue":"","operator":{"type":"string","operation":"notExists","singleValue":true}},{"id":"12fff553-64e2-4a6e-be8b-b87ed6e8943e","leftValue":"={{ $json.body.start }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-140,180],"id":"dc3dd03a-f60f-4d80-91ff-4c75f86bb281","name":"Invalid Start Date?"},{"parameters":{"respondWith":"json","responseBody":"{\n  \"error\": \"Bad request. Invalid value for 'task_id' or 'start' fields.\"\n}","options":{"responseCode":400}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[80,-80],"id":"733330c1-c80f-4322-900c-2a0dd3593fc6","name":"Bad Request"},{"parameters":{"operation":"get","tableId":"tasks","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $json.body.task_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[300,140],"id":"5dd5a40d-6ba2-4cc0-9ad3-519e34f7db50","name":"Get Task","credentials":{"supabaseApi":{"id":"PwJN4yKDRZqivq2f","name":"Supabase account"}}},{"parameters":{"mode":"chooseBranch"},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[80,140],"id":"14083f26-595e-4c30-bdb3-385d5f3995e0","name":"Merge"},{"parameters":{"workflowId":{"__rl":true,"value":"5nLuIwEVYbgbkXK2","mode":"list","cachedResultName":"Get Token"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"={{ $('When Executed by Another Workflow').item.json.task.user_id }}"},"matchingColumns":["user_id"],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[520,140],"id":"aae10b31-272d-4ca4-b63b-853bdc682316","name":"Get Token"},{"parameters":{"assignments":{"assignments":[{"id":"901f3674-46a1-49bd-8ecc-d00442ddfa0d","name":"attendees","value":"={{ ($('When Executed by Another Workflow').item.json.attendees ?? []).append($json.user.email)}}","type":"array"},{"id":"31775448-3649-4e21-bc93-c91cb76b015e","name":"endDate","value":"={{ DateTime.fromISO($('When Executed by Another Workflow').item.json.start).plus($('When Executed by Another Workflow').item.json.duration, 'minutes') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[740,140],"id":"708b3fa7-198b-435e-97f7-256751386604","name":"Set Attendees & End Date"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/calendar/v3/calendars/primary/events","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $('Get Token').item.json.accessToken }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify($json) }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1180,140],"id":"99aac5ea-811b-465c-b33f-bca6c35cb46f","name":"Create Event","retryOnFail":true,"maxTries":5,"onError":"continueErrorOutput"},{"parameters":{"options":{"responseCode":200}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1400,40],"id":"57239461-0bad-44fb-937f-2ac29cc0effd","name":"Success"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Add a new field called 'myNewField' to the JSON of the item\n$input.item.json.calendarRequest = {\n  description: $('When Executed by Another Workflow').item.json.task.description,\n  summary: $('When Executed by Another Workflow').item.json.title || $('When Executed by Another Workflow').item.json.task.description,\n  start: {\n    dateTime: $('When Executed by Another Workflow').item.json.start,\n    timeZone: $('Get Token').item.json.user.time_zone\n  },\n  end: {\n    dateTime: $json.endDate,\n    timeZone: $('Get Token').item.json.user.time_zone\n  },\n  reminders: {\n    useDefault: false,\n    overrides: [\n      {method: \"email\", minutes: 1440},\n      {method: \"popup\", \"minutes\": 10},\n    ],\n  },\n  attendees: $json.attendees?.map(email => ({ email })) ?? []\n};\n\nreturn $input.item;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[960,140],"id":"7460b74f-f804-419b-a631-2a5e3727a9a9","name":"Create Event Request"},{"parameters":{"options":{"responseCode":500,"responseKey":"=Problem creating the event: {{ $json.error }}"}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1400,240],"id":"2f615da5-c7db-47af-aedf-a349aa86a4e2","name":"Internal Server Error"},{"parameters":{"workflowInputs":{"values":[{"name":"task","type":"object"},{"name":"start"},{"name":"duration","type":"number"},{"name":"title"},{"name":"attendees","type":"array"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[60,440],"id":"d52f7cb4-b1b7-48e0-a3e6-cd6c1e9bca12","name":"When Executed by Another Workflow"}],"connections":{"Webhook":{"main":[[{"node":"Invalid Task ID?","type":"main","index":0},{"node":"Invalid Start Date?","type":"main","index":0}]]},"Invalid Task ID?":{"main":[[{"node":"Bad Request","type":"main","index":0}],[{"node":"Merge","type":"main","index":0}]]},"Invalid Start Date?":{"main":[[{"node":"Bad Request","type":"main","index":0}],[{"node":"Merge","type":"main","index":1}]]},"Get Task":{"main":[[{"node":"Get Token","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Get Task","type":"main","index":0}]]},"Get Token":{"main":[[{"node":"Set Attendees & End Date","type":"main","index":0}]]},"Set Attendees & End Date":{"main":[[{"node":"Create Event Request","type":"main","index":0}]]},"Create Event":{"main":[[{"node":"Success","type":"main","index":0}],[{"node":"Internal Server Error","type":"main","index":0}]]},"Create Event Request":{"main":[[{"node":"Create Event","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Get Token","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.srv845833.hstgr.cloud","user-agent":"axios/1.8.3","content-length":"141","accept":"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"172.18.0.1","x-forwarded-host":"n8n.srv845833.hstgr.cloud","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"6f7b0ad69aaf","x-real-ip":"172.18.0.1"},"params":{},"query":{},"body":{"task_id":"018644d6-fc73-406e-97d3-71f78f3fc84f","start":"2025-07-03T10:00:00.000","title":"Investigate n8n workflow failure","duration":60},"webhookUrl":"https://n8n.srv845833.hstgr.cloud/webhook/block-time","executionMode":"production"}}]},"versionId":"e9e29b26-9bf0-449d-94b5-6c49d85e59fe","triggerCount":1,"tags":[]}