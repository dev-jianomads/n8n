{"updatedAt":"2025-10-23T16:55:57.289Z","createdAt":"2025-08-27T21:47:08.355Z","id":"G7zoduW2QwUQ0lF6","name":"[TG] Get Cached User by TelegramID","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"telegramId","type":"number"}]}},"id":"977d2154-a713-4244-9190-79b328c18120","typeVersion":1.1,"name":"Start","type":"n8n-nodes-base.executeWorkflowTrigger","position":[304,-720]},{"parameters":{"operation":"get","propertyName":"user","key":"={{ $json.telegramId }}_USER","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[528,-720],"id":"63a1b690-06de-4094-b758-4ccc20826911","name":"Get Cached User","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f07b4a16-6b8e-4726-a150-11e59297c0b4","leftValue":"={{ $json.user }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}},{"id":"7d37698f-df1f-4ba9-ab0d-57fd172a7f22","leftValue":"={{ $json.user }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[752,-720],"id":"71d29f88-e7f0-49cf-aefb-3f68b5ea695d","name":"Exists?"},{"parameters":{"operation":"set","key":"={{ $('Start').item.json.telegramId }}_USER","value":"={{ JSON.stringify($json.user) }}","expire":true,"ttl":"={{ 1 * 24 * 60 * 60 }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1424,-688],"id":"c0b75913-f0ed-4d17-8c5d-9d135b3956ac","name":"Cache User","credentials":{"redis":{"id":"UKWNNzdg9opjGBYW","name":"Redis Cache"}}},{"parameters":{"mode":"chooseBranch","useDataOfInput":2},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1648,-624],"id":"9603ddbe-208f-46e0-8c57-443c05b4282d","name":"Merge"},{"parameters":{"mode":"raw","jsonOutput":"={{ JSON.parse($json.user) }}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[976,-816],"id":"7708d8f6-6821-4ca7-948d-c87a3e3ee37d","name":"Set User"},{"parameters":{"operation":"executeQuery","query":"SELECT public.get_user_by_telegram_id('{{ $('Start').item.json.telegramId }}') as user;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[976,-624],"id":"fc1e0fd8-e35d-4c3e-87fe-41b5104e4c85","name":"Get User by Telegram ID","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"operation":"executeQuery","query":"SELECT public.get_user_with_integrations('{{ $json.user.id }}') as user;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1200,-624],"id":"7a78a00e-01ed-4852-bd7e-e824e938cd7a","name":"Get User with Integrations","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"mode":"raw","jsonOutput":"={{ $json.user }}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1872,-624],"id":"b1c9470e-64db-4ac5-9b66-7ed44a1d7822","name":"Return User"}],"connections":{"Start":{"main":[[{"node":"Get Cached User","type":"main","index":0}]]},"Get Cached User":{"main":[[{"node":"Exists?","type":"main","index":0}]]},"Exists?":{"main":[[{"node":"Set User","type":"main","index":0}],[{"node":"Get User by Telegram ID","type":"main","index":0}]]},"Cache User":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Get User by Telegram ID":{"main":[[{"node":"Get User with Integrations","type":"main","index":0}]]},"Get User with Integrations":{"main":[[{"node":"Merge","type":"main","index":1},{"node":"Cache User","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Return User","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Start":[{"json":{"telegramId":1598386790}}]},"versionId":"898cd0fc-549e-4762-9ee3-c8f9088fa256","triggerCount":0,"shared":[{"updatedAt":"2025-08-27T21:47:08.355Z","createdAt":"2025-08-27T21:47:08.355Z","role":"workflow:owner","workflowId":"G7zoduW2QwUQ0lF6","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}