{"updatedAt":"2025-10-21T17:05:36.084Z","createdAt":"2025-10-14T22:21:22.998Z","id":"NOs8uISgMND4NjBf","name":"[WA] On New Message","active":true,"isArchived":false,"nodes":[{"parameters":{"updates":["messages"],"options":{}},"type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[-48,-304],"id":"f15e8ff2-6e90-4a5b-8fb1-eeb74b115934","name":"WhatsApp Trigger","webhookId":"9c276208-4753-4cad-9db7-3f9aea7b200c","credentials":{"whatsAppTriggerApi":{"id":"E6zgzaiMKkzeqacR","name":"WhatsApp OAuth account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT dev.get_whatsapp_user('{{ $json.contacts[0].wa_id }}');","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[400,-304],"id":"895df53b-f14c-475c-8386-90d999e54037","name":"Find User by WhatsApp ID","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4e2daa52-5c2f-46ab-a36d-9801b6a117dd","leftValue":"={{ $json.get_whatsapp_user }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[624,-304],"id":"f7d4615b-fa66-4f20-b8d6-e4a3ae21e639","name":"Found?"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b2971a46-fdc6-41c9-bceb-6573a287f960","leftValue":"={{ $json.keys().includes(\"statuses\") }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[176,-304],"id":"b7e98794-fd5d-4553-b52e-307e6c4dd9e9","name":"Ignore?"},{"parameters":{"operation":"send","phoneNumberId":"749915891538765","recipientPhoneNumber":"=+{{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}","textBody":"=Hi! Please sign up here: https://cal.hellotomo.ai/welcome","additionalFields":{}},"type":"n8n-nodes-base.whatsApp","typeVersion":1.1,"position":[848,-208],"id":"a2b6b7ea-db35-4e08-98e6-032ef62bc0e3","name":"Send Sign Up URL","webhookId":"6cdfa395-548b-477e-b41d-ae5117358a8a","credentials":{"whatsAppApi":{"id":"hn7HYT0djID7QTau","name":"WhatsApp account"}}},{"parameters":{"operation":"send","phoneNumberId":"749915891538765","recipientPhoneNumber":"=+{{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}","textBody":"=*Received* --> {{ $('WhatsApp Trigger').item.json.messages[0].text.body }}","additionalFields":{}},"type":"n8n-nodes-base.whatsApp","typeVersion":1.1,"position":[848,-400],"id":"0ecd2614-db7e-499a-b56f-8553b5fc5eaa","name":"Send Reply","webhookId":"6cdfa395-548b-477e-b41d-ae5117358a8a","credentials":{"whatsAppApi":{"id":"hn7HYT0djID7QTau","name":"WhatsApp account"}}}],"connections":{"WhatsApp Trigger":{"main":[[{"node":"Ignore?","type":"main","index":0}]]},"Find User by WhatsApp ID":{"main":[[{"node":"Found?","type":"main","index":0}]]},"Found?":{"main":[[{"node":"Send Reply","type":"main","index":0}],[{"node":"Send Sign Up URL","type":"main","index":0}]]},"Ignore?":{"main":[[],[{"node":"Find User by WhatsApp ID","type":"main","index":0}]]},"Send Sign Up URL":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"errorWorkflow":"63JMaA3ATIsJVc6Y"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"WhatsApp Trigger":[{"json":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15551366684","phone_number_id":"749915891538765"},"contacts":[{"profile":{"name":"AM III ðŸ‘‘"},"wa_id":"573195884149"}],"messages":[{"from":"573195884149","id":"wamid.HBgMNTczMTk1ODg0MTQ5FQIAEhggQUM3QzU4MDI0NjU2MDYwOEE0RkNFNDBFMEQwMEI2MDUA","timestamp":"1761065958","text":{"body":"Hello?"},"type":"text"}],"field":"messages"}}]},"versionId":"1a84a6e7-0156-45a4-a17d-29c7d2d56302","triggerCount":1,"shared":[{"updatedAt":"2025-10-14T22:21:22.998Z","createdAt":"2025-10-14T22:21:22.998Z","role":"workflow:owner","workflowId":"NOs8uISgMND4NjBf","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}