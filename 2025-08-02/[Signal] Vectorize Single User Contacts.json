{"createdAt":"2025-07-29T02:44:40.467Z","updatedAt":"2025-07-29T02:50:35.466Z","id":"uu7semjX1n1iWDt6","name":"[Signal] Vectorize Single User Contacts","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowId":{"__rl":true,"value":"pE2lsrstziYiLtF8","mode":"list","cachedResultName":"Get Token for Signal Integration"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"={{ $json.user_id }}"},"matchingColumns":["user_id"],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-320,-280],"id":"28fb975c-c3ff-4c50-a704-217ae52953bb","name":"Get Token"},{"parameters":{"url":"=https://people.googleapis.com/v1/otherContacts","sendQuery":true,"queryParameters":{"parameters":[{"name":"readMask","value":"names,emailAddresses"},{"name":"pageSize","value":"500"},{"name":"pageToken"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer {{ $json.accessToken }}"},{"name":"Content-Type","value":"application/json"}]},"options":{"pagination":{"pagination":{"parameters":{"parameters":[{"name":"pageToken","value":"={{ $response.body[\"nextPageToken\"] }}"}]},"paginationCompleteWhen":"other","completeExpression":"={{ $response.body[\"nextPageToken\"] === undefined || $response.body[\"nextPageToken\"] === null }}","requestInterval":30000}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-96,-280],"id":"2b01f6ee-82b4-4298-b356-dc944f9962c8","name":"Search Other Contacts","retryOnFail":true,"alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"mode":"insert","options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1.3,"position":[1264,-280],"id":"a942eec2-cbde-46c4-9204-0fc2b2414622","name":"Postgres PGVector Store","retryOnFail":true,"waitBetweenTries":5000,"maxTries":5,"credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"options":{"stripNewLines":true}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1248,-56],"id":"dbfb3b79-492a-4d96-bb91-bbcded309c6c","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"JNBPFneOXwzjzSKh","name":"OpenAi account"}}},{"parameters":{"jsonMode":"expressionData","jsonData":"=Names:\n{{ JSON.stringify($json.names ?? []) }}\n\nEmails:\n{{ JSON.stringify($json.emailAddresses ?? []) }}","textSplittingMode":"custom","options":{"metadata":{"metadataValues":[{"name":"user_id","value":"={{ $('Code').item.json.userId }}"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[1376,-56],"id":"0828c682-a725-4429-acec-a6bacb211e5a","name":"Default Data Loader"},{"parameters":{"chunkOverlap":20,"options":{}},"type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[1472,152],"id":"712e41a8-f856-4148-aaf7-8af4f6875cbc","name":"Recursive Character Text Splitter"},{"parameters":{"aggregate":"aggregateAllItemData","include":"specifiedFields","fieldsToInclude":"otherContacts","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[128,-280],"id":"e114264f-debf-4d76-b324-1d99a95039af","name":"Aggregate"},{"parameters":{"jsCode":"\nlet contacts = []\nfor (const item of $input.first().json.data) {\n  contacts = contacts.concat(item.otherContacts);\n}\n\nreturn {\n  json: {\n    contacts,\n    userId: $('Get Token').first().json.user.id\n  }\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[352,-280],"id":"6cfdffbd-48d5-4840-a947-2feaa348a31d","name":"Code"},{"parameters":{"fieldToSplitOut":"contacts","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[576,-280],"id":"49caf5f9-d5e1-471b-8871-9d7f78f09074","name":"Split Out"},{"parameters":{"operation":"executeQuery","query":"DELETE FROM n8n_vectors\nWHERE metadata->>'user_id' = '{{ $('Code').item.json.userId }}'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[800,-352],"id":"ae391b55-9a98-4d95-a654-1d40376e6569","name":"Delete Vectors","retryOnFail":true,"maxTries":5,"waitBetweenTries":5000,"credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}},"onError":"continueErrorOutput"},{"parameters":{"workflowInputs":{"values":[{"name":"user_id"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-544,-280],"id":"75cca6f7-a7b3-4b74-802c-98cd159c1fe1","name":"When Executed by Another Workflow"},{"parameters":{"mode":"chooseBranch","useDataOfInput":2},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1024,-280],"id":"599b485d-13cd-449f-89ba-7d6fc5d19b8c","name":"Merge"}],"connections":{"Get Token":{"main":[[{"node":"Search Other Contacts","type":"main","index":0}]]},"Search Other Contacts":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Postgres PGVector Store","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Postgres PGVector Store","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Aggregate":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Delete Vectors","type":"main","index":0},{"node":"Merge","type":"main","index":1}]]},"Delete Vectors":{"main":[[{"node":"Merge","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Get Token","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Postgres PGVector Store","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"bd8bcf71-9757-44d6-8100-4635e26b6e0c","triggerCount":0,"tags":[]}