{"createdAt":"2025-09-17T11:55:54.416Z","updatedAt":"2025-09-22T22:59:33.240Z","id":"JINPqbTyjPc6EUEM","name":"[TG] Send Daily Schedule","active":true,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1296,968],"id":"0dca6f3c-4f32-45f3-87c2-0b6e93e27eb2","name":"Loop Over Items"},{"parameters":{"model":"google/gemini-2.5-flash","options":{"temperature":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-400,1048],"id":"737868d3-3cdd-44d4-8bba-ce633d644a88","name":"Gemini 2.5 Flash","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"numberInputs":3,"rules":{"rule":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe59aac6-c1b6-4b01-a2c5-57242f67754f","leftValue":"={{ $('Set Random Index').item.json.model_index }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"}},{"modelIndex":2,"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a4d64c42-5fee-48ce-ad88-dee0bc253aa7","leftValue":"={{ $('Set Random Index').item.json.model_index }}","rightValue":1,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"}},{"modelIndex":3,"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1ca1ec11-df03-4a78-9362-63f7660874fa","leftValue":"={{ $('Set Random Index').item.json.model_index }}","rightValue":2,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"}}]}},"type":"@n8n/n8n-nodes-langchain.modelSelector","typeVersion":1,"position":[-352,840],"id":"9478dfc4-747b-4336-9bbf-34a923e3edd4","name":"Model Selector"},{"parameters":{"model":"openai/gpt-5-nano","options":{"temperature":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-272,1048],"id":"78761b3e-f137-4525-8f92-545f78d51e4e","name":"GPT 5 Nano","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{"temperature":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-144,1048],"id":"bf49eeb9-6bcd-4d36-8c86-f824131679c4","name":"Claude 3.5 Sonnet","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"assignments":{"assignments":[{"id":"c3c836a0-ba65-43ba-bc05-8da2387ed651","name":"model_index","value":"={{ Math.floor(Math.random() * 3) }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-624,616],"id":"c9b89f86-a2fc-486b-912a-cb3e6b492fd7","name":"Set Random Index"},{"parameters":{"jsonSchemaExample":"{\n  \"morning_message\": \"Rise and shine! Ready to tackle the day?\"\n}","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[32,840],"id":"5862a774-302f-4859-8d16-6d22f16ae3cf","name":"Structured Output Parser"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[28,1048],"id":"81f29f64-f3c1-4c69-bf5c-a924b93a85b0","name":"4.1 MINI","credentials":{"openAiApi":{"id":"JNBPFneOXwzjzSKh","name":"OpenAI account"}}},{"parameters":{"promptType":"define","text":"=Write a short, warm, and lightly playful good morning message for the person you assist. Keep it under three sentences. Avoid being overly cheerful or awkward. Output only the message text, no placeholders. Tone should balance professional assistant vibes with a friendly sidekick touch.\n\n# Examples:\n\n{\"morning_message\": \"Good morning! May your coffee be strong and your day kinder than expected.\"}\n\n{\"morning_message\": \"Rise and shine—today’s a fresh chance to win some small victories.\"}\n\n{\"morning_message\": \"Morning! Let’s keep today smooth, simple, and maybe even a little fun.\"}\n\n{\"morning_message\": \"Hello, sunshine. Don’t worry, I’ll keep the chaos in check for you.\"}\n\n{\"morning_message\": \"Good morning—let’s make today less about rushing and more about getting it right.\"}","hasOutputParser":true,"needsFallback":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-152,616],"id":"47e4ed61-8401-421a-bb66-ade4a190918e","name":"Morning Message Writer","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"B4R5PCXZUaCSSdbV","mode":"list","cachedResultName":"[TG] Send Telegram Message"},"workflowInputs":{"mappingMode":"defineBelow","value":{"message":"={{ $json.output.morning_message }}","telegramId":"={{ $('Loop Over Items').item.json.telegram_id }}","chatId":"={{ $('Loop Over Items').item.json.telegram_id }}","toolActivity":"={{ $json.toolActivity ?? [] }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"message","displayName":"message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatId","displayName":"chatId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"toolActivity","displayName":"toolActivity","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[400,544],"id":"8e0e24b9-4a43-4def-be9f-9f1cb3fb5b31","name":"Send Good Morning Message (Telegram)","onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"bNcOIAwEzwJCt4uG","mode":"list","cachedResultName":"[TG] Scheduling Agent"},"workflowInputs":{"mappingMode":"defineBelow","value":{"chat_history":"={{ {} }}","time_zone":"={{ $('Get Time Zone').first().json.timeZone }}","user":"={{ $('Loop Over Items').item.json }}","user_message":"How does my day look like?"},"matchingColumns":[],"schema":[{"id":"chat_history","displayName":"chat_history","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object"},{"id":"time_zone","displayName":"time_zone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_message","displayName":"user_message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user","displayName":"user","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{"waitForSubWorkflow":true}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[624,616],"id":"b2153b48-96a6-4cf4-8821-adcf80de8423","name":"Call Scheduler Agent"},{"parameters":{"operation":"executeQuery","query":"SELECT * \nFROM public.users\nWHERE telegram_id IS NOT NULL\nAND client_secret_2 IS NOT NULL\nAND client_id_2 IS NOT NULL\nAND refresh_token_2 IS NOT NULL\nAND access_token_2 IS NOT NULL","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1520,968],"id":"f89c3f13-62a8-4550-8b00-4aa4037c7122","name":"Get Valid Users","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"workflowId":{"__rl":true,"value":"vMEAaS35KPAgCfnj","mode":"list","cachedResultName":"[TG] Get Cached Time Zone"},"workflowInputs":{"mappingMode":"defineBelow","value":{"telegramId":"={{ $json.telegram_id }}","userId":"={{ $json.id }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-1072,616],"id":"61a8f436-bb42-4cac-8720-905ddc561652","name":"Get Time Zone"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c00f72a2-4665-4387-9770-cd2708ebdec0","leftValue":"={{ $('Every Hour').item.json.timestamp.toDateTime().setZone($json.timeZone).hour }}","rightValue":8,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-848,616],"id":"ded55dc8-262d-4eeb-aff0-0c7f9080087f","name":"8 AM in Local Zone?"},{"parameters":{"workflowId":{"__rl":true,"value":"B4R5PCXZUaCSSdbV","mode":"list","cachedResultName":"[TG] Send Telegram Message"},"workflowInputs":{"mappingMode":"defineBelow","value":{"message":"={{ $json.response }}","telegramId":"={{ $('Loop Over Items').item.json.telegram_id }}","chatId":"={{ $('Loop Over Items').item.json.telegram_id }}","toolActivity":"={{ $json.toolActivity ?? [] }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"message","displayName":"message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatId","displayName":"chatId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"toolActivity","displayName":"toolActivity","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[848,616],"id":"e813125b-4d27-48d4-a57b-35c628806978","name":"Send Telegram Message","onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"O0mTOcJxAhV0YuVI","mode":"list","cachedResultName":"[TG] Refresh Cached Chat History and Time Zone"},"workflowInputs":{"mappingMode":"defineBelow","value":{"telegramId":"={{ $('Loop Over Items').item.json.telegram_id }}","userId":"={{ $('Loop Over Items').item.json.id }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1072,792],"id":"08f6cbe3-7c9e-4b57-bac8-47e41e5690ed","name":"Refresh Caches"},{"parameters":{"rule":{"interval":[{"field":"hours"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1744,968],"id":"2c455316-2cbc-4a7c-9462-f905e61da5fa","name":"Every Hour"}],"connections":{"Loop Over Items":{"main":[[],[{"node":"Get Time Zone","type":"main","index":0}]]},"Gemini 2.5 Flash":{"ai_languageModel":[[{"node":"Model Selector","type":"ai_languageModel","index":0}]]},"Model Selector":{"ai_languageModel":[[{"node":"Morning Message Writer","type":"ai_languageModel","index":0}]]},"GPT 5 Nano":{"ai_languageModel":[[{"node":"Model Selector","type":"ai_languageModel","index":1}]]},"Claude 3.5 Sonnet":{"ai_languageModel":[[{"node":"Model Selector","type":"ai_languageModel","index":2}]]},"Set Random Index":{"main":[[{"node":"Morning Message Writer","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Morning Message Writer","type":"ai_outputParser","index":0}]]},"4.1 MINI":{"ai_languageModel":[[{"node":"Structured Output Parser","type":"ai_languageModel","index":0},{"node":"Morning Message Writer","type":"ai_languageModel","index":1}]]},"Morning Message Writer":{"main":[[{"node":"Send Good Morning Message (Telegram)","type":"main","index":0}],[{"node":"Call Scheduler Agent","type":"main","index":0}]]},"Send Good Morning Message (Telegram)":{"main":[[{"node":"Call Scheduler Agent","type":"main","index":0}]]},"Call Scheduler Agent":{"main":[[{"node":"Send Telegram Message","type":"main","index":0}]]},"Get Valid Users":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Get Time Zone":{"main":[[{"node":"8 AM in Local Zone?","type":"main","index":0}]]},"8 AM in Local Zone?":{"main":[[{"node":"Set Random Index","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"Send Telegram Message":{"main":[[{"node":"Refresh Caches","type":"main","index":0}]]},"Refresh Caches":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Every Hour":{"main":[[{"node":"Get Valid Users","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"63JMaA3ATIsJVc6Y"},"staticData":{"node:Every Hour1":{"recurrenceRules":[]},"node:Every Hour":{"recurrenceRules":[]}},"meta":null,"pinData":{},"versionId":"5ecb41cf-a8d9-47ee-a718-688818ff2588","triggerCount":1,"shared":[{"createdAt":"2025-09-17T11:55:54.416Z","updatedAt":"2025-09-17T11:55:54.416Z","role":"workflow:owner","workflowId":"JINPqbTyjPc6EUEM","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}