{"createdAt":"2025-09-11T20:34:42.683Z","updatedAt":"2025-09-23T17:54:55.304Z","id":"o1kvoTrzzgnRM69i","name":"üñ•Ô∏è [TG] Send Daily Schedule","active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"hours"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-112,-120],"id":"d823c2c5-91e6-4e82-987e-3dcf486ebc6f","name":"Every Hour"},{"parameters":{"operation":"executeQuery","query":"SELECT * \nFROM dev.users\nWHERE telegram_id IS NOT NULL\nAND client_secret_2 IS NOT NULL\nAND client_id_2 IS NOT NULL\nAND refresh_token_2 IS NOT NULL\nAND access_token_2 IS NOT NULL","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[112,-120],"id":"789d97bc-0380-4258-af76-b25c1f4dd88d","name":"Get Valid Users","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"workflowId":{"__rl":true,"value":"k1DGWUkYJAlFS4iw","mode":"list","cachedResultName":"üñ•Ô∏è [TG] Refresh Cached Chat History and Time Zone"},"workflowInputs":{"mappingMode":"defineBelow","value":{"telegramId":"={{ $('Loop Over Items').item.json.telegram_id }}","userId":"={{ $('Loop Over Items').item.json.id }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[3376,-296],"id":"ebc57cb9-6c86-416b-b9b9-b733796f0d0e","name":"Refresh Caches"},{"parameters":{"workflowId":{"__rl":true,"value":"9jeZuQfIDYEe9f5u","mode":"list","cachedResultName":"üñ•Ô∏è [TG] Get Cached Time Zone"},"workflowInputs":{"mappingMode":"defineBelow","value":{"telegramId":"={{ $json.telegram_id }}","userId":"={{ $json.id }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[560,-472],"id":"0cb0b434-bbd9-46c2-9550-c52a347501d2","name":"Get Time Zone"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c00f72a2-4665-4387-9770-cd2708ebdec0","leftValue":"={{ $('Every Hour').item.json.timestamp.toDateTime().setZone($json.timeZone).hour }}","rightValue":8,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[784,-472],"id":"ee09f1f9-7345-4fdb-be78-0696257b9ceb","name":"8 AM in Local Zone?"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[336,-120],"id":"35100993-bdc2-4088-925b-9ac2996d2613","name":"Loop Over Items"},{"parameters":{"model":"google/gemini-2.5-flash","options":{"temperature":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1232,-40],"id":"0bb8a37d-3675-4d72-b5b2-c8ca4ecd5136","name":"Gemini 2.5 Flash","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"numberInputs":3,"rules":{"rule":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"fe59aac6-c1b6-4b01-a2c5-57242f67754f","leftValue":"={{ $('Set Random Index').item.json.model_index }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"}},{"modelIndex":2,"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a4d64c42-5fee-48ce-ad88-dee0bc253aa7","leftValue":"={{ $('Set Random Index').item.json.model_index }}","rightValue":1,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"}},{"modelIndex":3,"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1ca1ec11-df03-4a78-9362-63f7660874fa","leftValue":"={{ $('Set Random Index').item.json.model_index }}","rightValue":2,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"}}]}},"type":"@n8n/n8n-nodes-langchain.modelSelector","typeVersion":1,"position":[1280,-248],"id":"9bc564f8-f72a-4a0d-bed6-538f37e62e44","name":"Model Selector"},{"parameters":{"model":"openai/gpt-5-nano","options":{"temperature":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1360,-40],"id":"cacd03f1-e935-473e-aa0f-1b4f883377c9","name":"GPT 5 Nano","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"model":"anthropic/claude-3.5-sonnet","options":{"temperature":1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1488,-40],"id":"71a34f7c-19ff-4f4c-9b31-6e111fd52ed6","name":"Claude 3.5 Sonnet","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"assignments":{"assignments":[{"id":"c3c836a0-ba65-43ba-bc05-8da2387ed651","name":"model_index","value":"={{ Math.floor(Math.random() * 3) }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1008,-472],"id":"a84f54ed-d7ef-4030-a8d4-8f274ad96ddc","name":"Set Random Index"},{"parameters":{"jsonSchemaExample":"{\n  \"morning_message\": \"Rise and shine! Ready to tackle the day?\"\n}","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[1664,-248],"id":"cd86a7c5-7fc2-4388-9bae-4556cc0bc3e4","name":"Structured Output Parser"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1660,-40],"id":"05bcb401-db4e-4dae-bb87-34b7dfd16833","name":"4.1 MINI","credentials":{"openAiApi":{"id":"JNBPFneOXwzjzSKh","name":"OpenAI account"}}},{"parameters":{"promptType":"define","text":"=Write a short, warm, and lightly playful good morning message for the person you assist. Keep it under three sentences. Avoid being overly cheerful or awkward. Output only the message text, no placeholders. Tone should balance professional assistant vibes with a friendly sidekick touch.\n\n# Examples:\n\n{\"morning_message\": \"Good morning! May your coffee be strong and your day kinder than expected.\"}\n\n{\"morning_message\": \"Rise and shine‚Äîtoday‚Äôs a fresh chance to win some small victories.\"}\n\n{\"morning_message\": \"Morning! Let‚Äôs keep today smooth, simple, and maybe even a little fun.\"}\n\n{\"morning_message\": \"Hello, sunshine. Don‚Äôt worry, I‚Äôll keep the chaos in check for you.\"}\n\n{\"morning_message\": \"Good morning‚Äîlet‚Äôs make today less about rushing and more about getting it right.\"}","hasOutputParser":true,"needsFallback":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1480,-472],"id":"005b270c-ccce-4502-98bc-9b718b69ca08","name":"Morning Message Writer","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"kI31iVTkkY44j2Rv","mode":"list","cachedResultName":"üñ•Ô∏è [TG] Send Telegram Message"},"workflowInputs":{"mappingMode":"defineBelow","value":{"message":"={{ $json.output.morning_message }}","telegramId":"={{ $('Loop Over Items').item.json.telegram_id }}","chatId":"={{ $('Loop Over Items').item.json.telegram_id }}","toolActivity":"={{ $json.toolActivity ?? [] }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"message","displayName":"message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatId","displayName":"chatId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"toolActivity","displayName":"toolActivity","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[2032,-544],"id":"a740f973-6a98-4f5b-a0f1-2db4ec0a09b1","name":"Send Good Morning Message (Telegram)","onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"utMh5rQmfWApLYFc","mode":"list","cachedResultName":"üñ•Ô∏è [TG] Scheduling Agent"},"workflowInputs":{"mappingMode":"defineBelow","value":{"chat_history":"={{ {} }}","time_zone":"={{ $('Get Time Zone').first().json.timeZone }}","user":"={{ $('Loop Over Items').item.json }}","user_message":"How does my day look like?"},"matchingColumns":[],"schema":[{"id":"chat_history","displayName":"chat_history","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object"},{"id":"time_zone","displayName":"time_zone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_message","displayName":"user_message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user","displayName":"user","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{"waitForSubWorkflow":true}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[2256,-472],"id":"506fd90c-70d3-4c32-890a-cc8929de83a0","name":"Call Scheduler Agent"},{"parameters":{"workflowId":{"__rl":true,"value":"kI31iVTkkY44j2Rv","mode":"list","cachedResultUrl":"/workflow/kI31iVTkkY44j2Rv","cachedResultName":"üñ•Ô∏è [TG] Send Telegram Message"},"workflowInputs":{"mappingMode":"defineBelow","value":{"message":"={{ $json.response }}","telegramId":"={{ $('Loop Over Items').item.json.telegram_id }}","chatId":"={{ $('Loop Over Items').item.json.telegram_id }}","toolActivity":"={{ $json.toolActivity ?? [] }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"message","displayName":"message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatId","displayName":"chatId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"toolActivity","displayName":"toolActivity","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[2928,-544],"id":"922ac029-7144-4c94-af43-11456f84d099","name":"Send Weather Info (TG)","onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"kI31iVTkkY44j2Rv","mode":"list","cachedResultUrl":"/workflow/kI31iVTkkY44j2Rv","cachedResultName":"üñ•Ô∏è [TG] Send Telegram Message"},"workflowInputs":{"mappingMode":"defineBelow","value":{"message":"={{ $('Call Scheduler Agent').item.json.response }}","telegramId":"={{ $('Loop Over Items').item.json.telegram_id }}","chatId":"={{ $('Loop Over Items').item.json.telegram_id }}","toolActivity":"={{ $('Call Scheduler Agent').item.json.toolActivity ?? [] }}"},"matchingColumns":[],"schema":[{"id":"telegramId","displayName":"telegramId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"message","displayName":"message","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"chatId","displayName":"chatId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"toolActivity","displayName":"toolActivity","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"array","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[3152,-464],"id":"813fa32e-1c1d-420e-9859-d6ef27741b2e","name":"Send Daily Schedule Telegram Message","onError":"continueRegularOutput"},{"parameters":{"workflowId":{"__rl":true,"value":"mh2OooSJDNqUVlIk","mode":"list","cachedResultUrl":"/workflow/mh2OooSJDNqUVlIk","cachedResultName":"üñ•Ô∏è [TG] Get Weather Report"},"workflowInputs":{"mappingMode":"defineBelow","value":{"scheduler_response":"={{ $json.response }}"},"matchingColumns":["scheduler_response"],"schema":[{"id":"scheduler_response","displayName":"scheduler_response","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.3,"position":[2480,-472],"id":"ededd958-abca-4c4a-8a0c-c81fcb3684ad","name":"Call 'üñ•Ô∏è [TG] Get Weather Report'"},{"parameters":{"conditions":{"options":{"caseSensitive":false,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4ef51d5b-541b-4466-a5bd-24a7a7b2b698","leftValue":"={{ $json.response }}","rightValue":"NONE","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{"ignoreCase":true}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2704,-472],"id":"6f11b32d-a237-42ff-9c3c-4efd96605e6a","name":"Response?"}],"connections":{"Every Hour":{"main":[[{"node":"Get Valid Users","type":"main","index":0}]]},"Refresh Caches":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Get Time Zone":{"main":[[{"node":"8 AM in Local Zone?","type":"main","index":0}]]},"Get Valid Users":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"8 AM in Local Zone?":{"main":[[{"node":"Set Random Index","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Get Time Zone","type":"main","index":0}]]},"Gemini 2.5 Flash":{"ai_languageModel":[[{"node":"Model Selector","type":"ai_languageModel","index":0}]]},"Model Selector":{"ai_languageModel":[[{"node":"Morning Message Writer","type":"ai_languageModel","index":0}]]},"GPT 5 Nano":{"ai_languageModel":[[{"node":"Model Selector","type":"ai_languageModel","index":1}]]},"Claude 3.5 Sonnet":{"ai_languageModel":[[{"node":"Model Selector","type":"ai_languageModel","index":2}]]},"Set Random Index":{"main":[[{"node":"Morning Message Writer","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Morning Message Writer","type":"ai_outputParser","index":0}]]},"4.1 MINI":{"ai_languageModel":[[{"node":"Structured Output Parser","type":"ai_languageModel","index":0},{"node":"Morning Message Writer","type":"ai_languageModel","index":1}]]},"Morning Message Writer":{"main":[[{"node":"Send Good Morning Message (Telegram)","type":"main","index":0}],[{"node":"Call Scheduler Agent","type":"main","index":0}]]},"Send Good Morning Message (Telegram)":{"main":[[{"node":"Call Scheduler Agent","type":"main","index":0}]]},"Call Scheduler Agent":{"main":[[{"node":"Call 'üñ•Ô∏è [TG] Get Weather Report'","type":"main","index":0}]]},"Send Weather Info (TG)":{"main":[[{"node":"Send Daily Schedule Telegram Message","type":"main","index":0}]]},"Send Daily Schedule Telegram Message":{"main":[[{"node":"Refresh Caches","type":"main","index":0}]]},"Call 'üñ•Ô∏è [TG] Get Weather Report'":{"main":[[{"node":"Response?","type":"main","index":0}]]},"Response?":{"main":[[{"node":"Send Weather Info (TG)","type":"main","index":0}],[{"node":"Send Daily Schedule Telegram Message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"63JMaA3ATIsJVc6Y"},"staticData":{"node:Run Every 30 Seconds":{"recurrenceRules":[]},"node:Run Every 15 Seconds":{"recurrenceRules":[]},"node:Run Every 5 Seconds":{"recurrenceRules":[]},"node:Every Hour":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Every Hour":[{"json":{"timestamp":"2025-09-17T20:00:10.004+02:00","Readable date":"September 17th 2025, 8:00:10 pm","Readable time":"8:00:10 pm","Day of week":"Wednesday","Year":"2025","Month":"September","Day of month":"17","Hour":"20","Minute":"00","Second":"10","Timezone":"Europe/Berlin (UTC+02:00)"}}]},"versionId":"9c39a3b6-1d32-4432-a66c-a1710e9556c9","triggerCount":1,"shared":[{"createdAt":"2025-09-11T20:34:42.683Z","updatedAt":"2025-09-11T20:34:42.683Z","role":"workflow:owner","workflowId":"o1kvoTrzzgnRM69i","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}