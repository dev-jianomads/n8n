{"updatedAt":"2025-11-04T19:50:32.031Z","createdAt":"2025-11-04T16:45:36.439Z","id":"3Kp77vn3ETiWLCFB","name":"[WA] Google Places Search API","active":false,"isArchived":false,"nodes":[{"parameters":{"method":"POST","url":"https://places.googleapis.com/v1/places:searchText","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Goog-Api-Key","value":"AIzaSyBpFjB5LAjnIUVf7ZyGSIQ4NWnLjgepcoM"},{"name":"X-Goog-FieldMask","value":"places.displayName,places.formattedAddress,places.photos,places.rating,places.googleMapsUri,places.websiteUri"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"textQuery","value":"={{ $('When Executed by Another Workflow').item.json.query }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1024,-216],"id":"ae254ada-ddc3-425d-b0fd-a3af571b2f2a","name":"Search Places","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"url":"=https://places.googleapis.com/v1/{{ $('Limit').item.json.photos[0].name }}/media","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"AIzaSyBpFjB5LAjnIUVf7ZyGSIQ4NWnLjgepcoM"},{"name":"maxHeightPx","value":"1600"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[96,-288],"id":"936834da-7309-4c40-8fc0-283df2872178","name":"Download Image","onError":"continueErrorOutput"},{"parameters":{"workflowInputs":{"values":[{"name":"query"},{"name":"whatsAppId"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1248,-216],"id":"1bc1cbdc-8999-4f26-b08d-992725521a27","name":"When Executed by Another Workflow"},{"parameters":{"fieldToSplitOut":"places","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-800,-288],"id":"39e94db4-53bf-4ec6-b069-04fe6aa1aace","name":"Split Out"},{"parameters":{"maxItems":3},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-128,-288],"id":"458946a1-c37f-4308-90d5-bf14bb918437","name":"Limit"},{"parameters":{"tableId":"whatsapp_messages","fieldsUi":{"fieldValues":[{"fieldId":"whatsapp_date","fieldValue":"={{ $now.toSeconds().round() }}"},{"fieldId":"whatsapp_date_utc","fieldValue":"={{ $now.toDateTime('s').toUTC().toISO() }}"},{"fieldId":"text","fieldValue":"={{$('Set Params').item.json.caption }}"},{"fieldId":"direction","fieldValue":"outbound"},{"fieldId":"sender_id","fieldValue":"={{ $('Set Params').item.json.tomoWhatsAppId }}"},{"fieldId":"recipient_id","fieldValue":"={{ $('When Executed by Another Workflow').item.json.whatsAppId }}"},{"fieldId":"whatsapp_message_id","fieldValue":"={{ $('Send message').item.json.messages[0].id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[992,-336],"id":"5203a915-3e14-4894-8d57-3d56bdec2469","name":"Save Message","credentials":{"supabaseApi":{"id":"PwJN4yKDRZqivq2f","name":"Supabase account"}}},{"parameters":{"assignments":{"assignments":[{"id":"4c47c47f-daf9-401c-9148-42e5e00bdcf9","name":"response","value":"={{ $json.concatenated_text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1664,-336],"id":"4c9f9278-16a8-40ba-a2d7-929c4b22f89e","name":"Set Successful Response","executeOnce":true},{"parameters":{"assignments":{"assignments":[{"id":"6587096c-e9d7-498e-a8f9-374befde1b85","name":"response","value":"There was a problem searching for places.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[320,-120],"id":"cc8ff83f-1382-4a6f-96d0-9eea2a6c2a27","name":"Set Error Response"},{"parameters":{"fieldsToSummarize":{"values":[{"aggregation":"concatenate","field":"text","separateBy":"other","customSeparator":"\\n---\\n"}]},"options":{}},"type":"n8n-nodes-base.summarize","typeVersion":1.1,"position":[1216,-432],"id":"291b0d53-f83b-4fd2-bd68-9454088aac26","name":"Concatenate Options"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0b436d84-0f54-49c9-a0ef-ca5f9d07a4c4","leftValue":"={{ $json.rating }}","rightValue":4.5,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-576,-288],"id":"ccc79587-110d-4bdf-8d4d-6b38cb1e4356","name":"Filter"},{"parameters":{"type":"random"},"type":"n8n-nodes-base.sort","typeVersion":1,"position":[-352,-288],"id":"b24981b9-4acb-487c-892c-c82e6a44a5a2","name":"Randomize"},{"parameters":{"operation":"send","phoneNumberId":"749915891538765","recipientPhoneNumber":"+573195884149","messageType":"image","mediaPath":"useMediaId","mediaId":"={{ $json.id }}","additionalFields":{"mediaCaption":"={{ $json.caption }}"}},"type":"n8n-nodes-base.whatsApp","typeVersion":1.1,"position":[768,-336],"id":"2f1f6296-588a-4ce1-abd1-6ac264b2618c","name":"Send message","webhookId":"2c8c4431-cda9-450f-883c-a08c945b3cb9","credentials":{"whatsAppApi":{"id":"hn7HYT0djID7QTau","name":"WhatsApp account"}}},{"parameters":{"resource":"media","phoneNumberId":"749915891538765","additionalFields":{}},"type":"n8n-nodes-base.whatsApp","typeVersion":1.1,"position":[320,-336],"id":"ea0345ca-de77-4365-88d6-934031293541","name":"Upload media","webhookId":"e21f20bb-8a81-4ab1-9de2-f25ac85c05fe","credentials":{"whatsAppApi":{"id":"hn7HYT0djID7QTau","name":"WhatsApp account"}}},{"parameters":{"assignments":{"assignments":[{"id":"2bc3e4f7-6d56-495c-addb-2fcd8543c051","name":"=caption","value":"=Option #{{ $itemIndex + 1 }}: *{{$('Download Image').item.json.displayName.text}}*  \n\nLink: {{$('Download Image').item.json.googleMapsUri}} \nRating: {{ $('Download Image').item.json.rating }} \nAddress: {{ $('Download Image').item.json.formattedAddress }}","type":"string"},{"id":"ca1a3a8e-35a5-4780-9715-58dfac511b4c","name":"tomoWhatsAppId","value":"15551366684","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[544,-336],"id":"0f551c49-10e2-427e-82d9-34494c3b5848","name":"Set Params"},{"parameters":{"resource":"media","operation":"mediaDelete","mediaDeleteId":"={{ $('Set Params').item.json.id }}"},"type":"n8n-nodes-base.whatsApp","typeVersion":1.1,"position":[1216,-240],"id":"c0344e70-b747-4a42-8b9b-1ff57a695dc2","name":"Delete media","webhookId":"66a24dbb-5c05-4c52-aab3-45efb65c3701","credentials":{"whatsAppApi":{"id":"hn7HYT0djID7QTau","name":"WhatsApp account"}},"onError":"continueRegularOutput"},{"parameters":{"mode":"chooseBranch"},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1440,-336],"id":"fa36d012-9702-492c-af51-829b33c62f49","name":"Merge"}],"connections":{"Search Places":{"main":[[{"node":"Split Out","type":"main","index":0}],[{"node":"Set Error Response","type":"main","index":0}]]},"Download Image":{"main":[[{"node":"Upload media","type":"main","index":0}],[{"node":"Set Error Response","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Search Places","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Filter","type":"main","index":0}]]},"Limit":{"main":[[{"node":"Download Image","type":"main","index":0}]]},"Save Message":{"main":[[{"node":"Concatenate Options","type":"main","index":0},{"node":"Delete media","type":"main","index":0}]]},"Concatenate Options":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Filter":{"main":[[{"node":"Randomize","type":"main","index":0}]]},"Randomize":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Upload media":{"main":[[{"node":"Set Params","type":"main","index":0}]]},"Send message":{"main":[[{"node":"Save Message","type":"main","index":0}]]},"Set Params":{"main":[[{"node":"Send message","type":"main","index":0}]]},"Delete media":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Set Successful Response","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"query":"cool restaurants in Usaquén, Bogotá","whatsAppId":"573195884149"}}]},"versionId":"1dd6aa5e-9754-4e4d-9cc4-5a9e83531b3e","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-04T16:45:36.439Z","createdAt":"2025-11-04T16:45:36.439Z","role":"workflow:owner","workflowId":"3Kp77vn3ETiWLCFB","projectId":"8nyfoRCh3nEYWaKJ"}],"activeVersion":null,"tags":[]}