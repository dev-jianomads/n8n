{"updatedAt":"2025-07-17T22:50:41.451Z","createdAt":"2025-06-10T22:22:28.215Z","id":"US4fQXGWPNioP17Q","name":"Task Agent","active":true,"isArchived":false,"nodes":[{"parameters":{"public":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-300,-20],"id":"6b2a296b-5781-451f-80e7-c685f3e3a972","name":"When chat message received","webhookId":"95720286-0bb4-4e95-acca-5d6a42b03ef8"},{"parameters":{"operation":"getAll","tableId":"tasks","limit":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}","matchType":"allFilters","filters":{"conditions":[{"keyName":"user_id","condition":"eq","keyValue":"={{ $('Get Task').item.json.user_id }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[1260,300],"id":"a36902a7-0ffa-4f0a-9bf4-e7e8a34dca37","name":"Get Tasks","credentials":{"supabaseApi":{"id":"PwJN4yKDRZqivq2f","name":"Supabase account"}}},{"parameters":{"operation":"getAll","tableId":"emails","filters":{"conditions":[{"keyName":"user_id","condition":"eq","keyValue":"={{ $('Get Task').item.json.user_id }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[1380,300],"id":"8051be24-07ff-400d-aa48-ceb55e47da10","name":"Get Emails","credentials":{"supabaseApi":{"id":"PwJN4yKDRZqivq2f","name":"Supabase account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Use this tool to fetch a single email by ID. If you are notice the ID must be a VALID UUID. You'll usually find it in the \"extracted_from_id\" column of the tasks table.","operation":"get","tableId":"emails","filters":{"conditions":[{"keyName":"id","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', ``, 'string') }}"},{"keyName":"user_id","keyValue":"={{ $('Get Task').item.json.user_id }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[1500,300],"id":"1c7f62d2-2dd8-45b3-a2c6-3bd408bbd539","name":"Get Single Email","credentials":{"supabaseApi":{"id":"PwJN4yKDRZqivq2f","name":"Supabase account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[1620,300],"id":"52220304-cd66-4e96-ae6f-1a773455b760","name":"Think"},{"parameters":{"promptType":"define","text":"={{ $('Set Task ID and Message').item.json.message }}","hasOutputParser":true,"options":{"systemMessage":"=# Role\nYou are a Task Agent, a specialized assistant designed to provide insights about tasks extracted from emails in a user's inbox. Your role is to relate these tasks with other tasks assigned to the user, answer questions about the emails, and expand on entities mentioned in the emails by searching the web.\n\n# Task\nYour primary function is to assist the user in managing and understanding their tasks and emails more effectively. This includes identifying the context of tasks, relating them to other tasks, providing detailed answers about emails, and conducting web searches to provide additional information on specific entities mentioned within these tasks or emails.\n\n## Specifics\n- Focus on providing insights related to tasks extracted from emails.\n- Relate tasks to other tasks assigned to the user to help with prioritization and organization.\n- Answer questions specifically about the emails in the user's inbox.\n- Use web searches to expand on entities mentioned in emails when necessary.\n- Maintain a helpful and concise communication style, ensuring your responses are complete and to the point.\n- Redirect any off-topic questions back to tasks, emails, and related subjects gently and politely.\n\n# Tools\nYou have access to several tools to assist you in your tasks:\n1. **Tavily**: Use this tool to search the web for information.\n2. **Think**: Utilize this tool to take notes, double-check your thinking, and process your tasks.\n3. **Get Tasks**: Retrieve tasks assigned to the user.\n4. **Get Emails**: Access emails assigned to the user.\n5. **Get Single Email**: Fetch a single email by ID assigned to the user.\n6. **Find Time**: Use this tool to get user's calendar availability to work on this task.\n7. **Block Time**: Use this tool to create calendar events related to the task.\n\n# Notes\n- Always maintain a helpful tone, aiming to assist the user as efficiently as possible.\n- Be concise yet complete in your answers, ensuring you provide all necessary information without overwhelming the user.\n- Focus solely on questions related to tasks and emails. If the user asks unrelated questions, gently redirect them to the main topics of tasks, emails, and related information.\n- Utilize the tools provided effectively, choosing the right tool for the task at hand to provide the most accurate and helpful information.\n\n# IMPORTANT:\n* Always use markdown in your responses, especially when you render links so they are clickable.\n* Your main goal is to answer questions about the following task: {{ JSON.stringify($('Get Task').item.json) }}\n\n# Extra Notes:\nToday's date: {{ $now.toUTC().format('DDDD') }}","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[1420,80],"id":"aeace032-4921-489b-b9c2-b61bd25383ab","name":"Task Agent"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Get Task').item.json.id.toString() + $('Get Task').item.json.user_id.toString() }}","tableName":"task_agent_chat_histories"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[1140,300],"id":"1a9eac3b-4688-4693-97b6-ac5057551ac5","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"hcrXy03eb7cfXzVe","name":"Supabase TX Pooler"}}},{"parameters":{"query":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Query', ``, 'string') }}","options":{}},"type":"@tavily/n8n-nodes-tavily.tavilyTool","typeVersion":1,"position":[1740,300],"id":"7940246a-a241-4250-9f25-4abc6bd01e37","name":"Tavily","credentials":{"tavilyApi":{"id":"pQpYp2R81K4M8MWk","name":"Tavily account"}}},{"parameters":{"respondWith":"json","responseBody":"={\n  \"output\": {{ JSON.stringify($json.output) }}\n}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.3,"position":[2180,80],"id":"ebfb33ac-1a6f-4b77-92be-5c16e6b6b3ab","name":"Respond to Webhook"},{"parameters":{"operation":"get","tableId":"tasks","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $json.taskId }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[620,80],"id":"4a2afc80-012d-40ef-b90c-bfd212efd531","name":"Get Task","credentials":{"supabaseApi":{"id":"PwJN4yKDRZqivq2f","name":"Supabase account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c2909df2-bd9b-454b-8627-1faf404a5fbd","leftValue":"={{ $json.metadata }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-80,-20],"id":"aad7e625-420b-418e-a00f-7cf502280c3d","name":"Metadata?"},{"parameters":{"assignments":{"assignments":[{"id":"8ed722f6-fd28-41e0-8a22-214f3a0c23d2","name":"=taskId","value":"={{ $json.metadata.taskId }}","type":"string"},{"id":"5ab1d9cf-3d27-43c4-a1be-0644d0d3ff0f","name":"message","value":"={{ $('When chat message received').item.json.chatInput }}","type":"string"},{"id":"1bce9f7a-dc45-4063-a0bf-dd1d90b939e3","name":"","value":"","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[140,-120],"id":"69b27918-207b-4ae3-8b09-6e1384bfc4a7","name":"Set Task ID from Metadata"},{"parameters":{"assignments":{"assignments":[{"id":"26dd035d-58af-4404-9915-a46aad3e64aa","name":"taskId","value":"=018644d6-fc73-406e-97d3-71f78f3fc84f","type":"string"},{"id":"0a272349-5ffa-40b1-b5af-ab2b9a53986e","name":"message","value":"={{ $('When chat message received').item.json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[140,80],"id":"afad1321-0856-4cb1-8815-c166b0d9311e","name":"Set Test Task ID"},{"parameters":{"content":"\nChange the test task ID here ☝️","height":80,"width":260},"type":"n8n-nodes-base.stickyNote","position":[20,460],"typeVersion":1,"id":"7b18d13c-4db8-42ae-b512-456cc488fc47","name":"Sticky Note"},{"parameters":{"httpMethod":"POST","path":"task-agent","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-80,280],"id":"3b9631be-0d78-4dba-9271-dde6a34fb2dc","name":"Webhook","webhookId":"02afb212-62d1-4620-8a88-c2e4629b778d"},{"parameters":{"assignments":{"assignments":[{"id":"d83d994e-6be7-47b2-9186-b4ed4e69cb3a","name":"taskId","value":"={{ $json.body.taskId }}","type":"string"},{"id":"66d748aa-fc2a-4be6-8f7b-68a4edf1bc43","name":"message","value":"={{ $json.body.message }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[140,280],"id":"f0e0b606-3188-4f48-bdcc-b0a968be7f91","name":"Set Task ID and Message from Request"},{"parameters":{"assignments":{"assignments":[{"id":"26dd035d-58af-4404-9915-a46aad3e64aa","name":"taskId","value":"={{ $json.taskId }}","type":"string"},{"id":"00dec78f-2bd3-4baf-878b-093f27258d0d","name":"message","value":"={{ $json.message }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[360,80],"id":"b4e2dbc2-f84a-4124-a330-b224e0c6d204","name":"Set Task ID and Message"},{"parameters":{"toolDescription":"Use this tool to create events on the calendar related to this task.","method":"POST","url":"https://n8n.srv845833.hstgr.cloud/webhook/block-time","sendBody":true,"bodyParameters":{"parameters":[{"name":"task_id","value":"={{ $fromAI('parameters0_Value', `The id of the task you will block time for.`, 'string') }}"},{"name":"start","value":"={{ $fromAI('parameters1_Value', `Start date of the event ISO formatted. String.`, 'string') }}"},{"name":"=title","value":"={{ $fromAI('parameters3_Value', `The title of the event.`, 'string') }}"},{"name":"duration","value":"={{ $fromAI('parameters4_Value', `Duration of the event`, 'number', 60) }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1860,300],"id":"a251562c-8bd2-49cb-b0cf-949b85061a50","name":"Block Time"},{"parameters":{"model":"openai/gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1020,300],"id":"556e8bbd-50e1-4566-ba35-6e8d595fb288","name":"4.1","credentials":{"openRouterApi":{"id":"SeBKTiKFu0nP1GsL","name":"OpenRouter account"}}},{"parameters":{"description":"Use this tool to find available times to work on the task.","workflowId":{"__rl":true,"value":"ramO7SKqRRti5Vq4","mode":"list","cachedResultName":"Find Time (Tool)"},"workflowInputs":{"mappingMode":"defineBelow","value":{"task":"={{ $('Get Task').item.json }}","userId":"={{ $('Get Task').item.json.user_id }}","limit":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('limit', `How many find blocks to find. Default to 3.`, 'number') }}","user":"={{ $('Get Token and User').item.json.user }}","accessToken":"={{ $('Get Token and User').item.json.accessToken }}"},"matchingColumns":[],"schema":[{"id":"task","displayName":"task","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object"},{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"limit","displayName":"limit","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"user","displayName":"user","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"object","removed":false},{"id":"accessToken","displayName":"accessToken","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1980,300],"id":"3bb96411-ea00-4d6c-9ecf-fdd6c25149f9","name":"Find Time"},{"parameters":{"workflowId":{"__rl":true,"value":"5nLuIwEVYbgbkXK2","mode":"list","cachedResultName":"Get Token"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"={{ $json.user_id }}"},"matchingColumns":["user_id"],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[840,80],"id":"a6d845fa-6baa-40e9-b7bf-5d154364273f","name":"Get Token and User"}],"connections":{"When chat message received":{"main":[[{"node":"Metadata?","type":"main","index":0}]]},"Get Tasks":{"ai_tool":[[{"node":"Task Agent","type":"ai_tool","index":0}]]},"Get Emails":{"ai_tool":[[{"node":"Task Agent","type":"ai_tool","index":0}]]},"Get Single Email":{"ai_tool":[[{"node":"Task Agent","type":"ai_tool","index":0}]]},"Think":{"ai_tool":[[{"node":"Task Agent","type":"ai_tool","index":0}]]},"Task Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"Task Agent","type":"ai_memory","index":0}]]},"Tavily":{"ai_tool":[[{"node":"Task Agent","type":"ai_tool","index":0}]]},"Get Task":{"main":[[{"node":"Get Token and User","type":"main","index":0}]]},"Metadata?":{"main":[[{"node":"Set Task ID from Metadata","type":"main","index":0}],[{"node":"Set Test Task ID","type":"main","index":0}]]},"Set Task ID from Metadata":{"main":[[{"node":"Set Task ID and Message","type":"main","index":0}]]},"Set Test Task ID":{"main":[[{"node":"Set Task ID and Message","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Set Task ID and Message from Request","type":"main","index":0}]]},"Set Task ID and Message from Request":{"main":[[{"node":"Set Task ID and Message","type":"main","index":0}]]},"Set Task ID and Message":{"main":[[{"node":"Get Task","type":"main","index":0}]]},"Block Time":{"ai_tool":[[{"node":"Task Agent","type":"ai_tool","index":0}]]},"4.1":{"ai_languageModel":[[{"node":"Task Agent","type":"ai_languageModel","index":0}]]},"Find Time":{"ai_tool":[[{"node":"Task Agent","type":"ai_tool","index":0}]]},"Get Token and User":{"main":[[{"node":"Task Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.srv845833.hstgr.cloud","user-agent":"PostmanRuntime/7.44.1","content-length":"118","accept":"*/*","accept-encoding":"gzip, deflate, br","content-type":"application/json","postman-token":"3f1290ac-3600-47dc-80ec-8548535086a1","x-forwarded-for":"181.61.208.141","x-forwarded-host":"n8n.srv845833.hstgr.cloud","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"6f7b0ad69aaf","x-real-ip":"181.61.208.141"},"params":{},"query":{},"body":{"taskId":"018644d6-fc73-406e-97d3-71f78f3fc84f","message":"I want to work on this tomorrow at 10 am"},"webhookUrl":"https://n8n.srv845833.hstgr.cloud/webhook/task-agent","executionMode":"production"}}]},"versionId":"563b012f-7d95-4335-a6f6-4e7205570b8b","triggerCount":2,"shared":[{"updatedAt":"2025-06-10T22:22:28.215Z","createdAt":"2025-06-10T22:22:28.215Z","role":"workflow:owner","workflowId":"US4fQXGWPNioP17Q","projectId":"8nyfoRCh3nEYWaKJ"}],"tags":[]}